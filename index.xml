<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Kevin Niederwanger</title><link>https://www.niederwanger.dev/</link><description>Recent content on Kevin Niederwanger</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Fri, 04 Apr 2025 00:00:00 +0000</lastBuildDate><atom:link href="https://www.niederwanger.dev/index.xml" rel="self" type="application/rss+xml"/><item><title>Who rebooted my VM? A cloud mystery</title><link>https://www.niederwanger.dev/p/who-rebooted-my-vm/</link><pubDate>Fri, 04 Apr 2025 00:00:00 +0000</pubDate><guid>https://www.niederwanger.dev/p/who-rebooted-my-vm/</guid><description>&lt;img src="https://www.niederwanger.dev/p/who-rebooted-my-vm/cover.png" alt="Featured image of post Who rebooted my VM? A cloud mystery" />&lt;h2 id="who-rebooted-my-vm-a-cloud-mystery">Who rebooted my VM? A cloud mystery
&lt;/h2>&lt;p>I had been recently involved in an interesting discussion on how to figure out, who has rebooted your virtual machine from a linux perspective. In this particular case, we were talking about an OpenShift &lt;code>node&lt;/code>. I will be elaborating on a few different cases and how those can be investigated.&lt;/p>
&lt;p>To reproduce the problem, I am using a five node OpenShift cluster which is running on a &lt;code>Kernel Based Virtual Machine (KVM)&lt;/code> host.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ oc get nodes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">compute-0 Ready worker 3d23h v1.31.6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">compute-1 Ready worker 3d23h v1.31.6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master-0 Ready control-plane,master,worker 3d23h v1.31.6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master-1 Ready control-plane,master,worker 3d23h v1.31.6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master-2 Ready control-plane,master,worker 3d23h v1.31.6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ virsh list
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Id Name State
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">2&lt;/span> ocp4-master-0 running
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">3&lt;/span> ocp4-master-1 running
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">4&lt;/span> ocp4-master-2 running
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">5&lt;/span> ocp4-compute-0 running
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">6&lt;/span> ocp4-compute-1 running
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Consequently, I am my own hypervisor admin which will be sabotaging my OpenShift cluster for this investigation.&lt;/p>
&lt;p>What all cases will have in common is that a node will be &lt;code>NotReady&lt;/code> for some time, e.g.:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ oc get nodes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">compute-0 Ready worker 4d15h v1.31.6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">compute-1 NotReady worker 4d15h v1.31.6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master-0 Ready control-plane,master,worker 4d15h v1.31.6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master-1 Ready control-plane,master,worker 4d15h v1.31.6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master-2 Ready control-plane,master,worker 4d15h v1.31.6
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Additionally you will be able to find logs of the machine config controller which reports a &lt;code>NotReady&lt;/code> machine:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ oc -n openshift-machine-config-operator logs machine-config-controller-5f88fbbc4f-rqjm4 -c machine-config-controller &lt;span class="p">|&lt;/span> grep -i compute-1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">I0404 06:41:13.153952 &lt;span class="m">1&lt;/span> node_controller.go:584&lt;span class="o">]&lt;/span> Pool worker: node compute-1: Reporting unready: node compute-1 is reporting &lt;span class="nv">OutOfDisk&lt;/span>&lt;span class="o">=&lt;/span>Unknown
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">I0404 06:41:13.196590 &lt;span class="m">1&lt;/span> node_controller.go:584&lt;span class="o">]&lt;/span> Pool worker: node compute-1: changed taints
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">I0404 06:41:19.481728 &lt;span class="m">1&lt;/span> node_controller.go:584&lt;span class="o">]&lt;/span> Pool worker: node compute-1: changed taints
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">I0404 06:42:42.730148 &lt;span class="m">1&lt;/span> node_controller.go:584&lt;span class="o">]&lt;/span> Pool worker: node compute-1: Reporting unready: node compute-1 is reporting &lt;span class="nv">NotReady&lt;/span>&lt;span class="o">=&lt;/span>False
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">I0404 06:42:56.309260 &lt;span class="m">1&lt;/span> node_controller.go:584&lt;span class="o">]&lt;/span> Pool worker: node compute-1: Reporting ready
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="case-1-user-reboot">Case 1: User reboot
&lt;/h2>&lt;p>In this case a user has rebooted one of your nodes (either via a &lt;code>debug&lt;/code> container or via &lt;code>ssh&lt;/code>). This can be easily found with the audit logs:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ cat /var/log/audit/audit.log &lt;span class="p">|&lt;/span> grep reboot
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">type&lt;/span>&lt;span class="o">=&lt;/span>USER_CMD &lt;span class="nv">msg&lt;/span>&lt;span class="o">=&lt;/span>audit&lt;span class="o">(&lt;/span>1743748835.979:805&lt;span class="o">)&lt;/span>: &lt;span class="nv">pid&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">1366614&lt;/span> &lt;span class="nv">uid&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">auid&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">4294967295&lt;/span> &lt;span class="nv">ses&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">4294967295&lt;/span> &lt;span class="nv">subj&lt;/span>&lt;span class="o">=&lt;/span>system_u:system_r:spc_t:s0 &lt;span class="nv">msg&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;cwd=&amp;#34;/&amp;#34; cmd=&amp;#34;reboot&amp;#34; exe=&amp;#34;/usr/bin/sudo&amp;#34; terminal=? res=success&amp;#39;&lt;/span>&lt;span class="nv">UID&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;root&amp;#34;&lt;/span> &lt;span class="nv">AUID&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;unset&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="case-2-machine-config-rollout">Case 2: Machine Config rollout
&lt;/h2>&lt;p>A machine config rollout can also be found in the &lt;code>audit.log&lt;/code> files:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ cat /var/log/audit/audit.log &lt;span class="p">|&lt;/span> grep reboot
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">type&lt;/span>&lt;span class="o">=&lt;/span>SERVICE_START &lt;span class="nv">msg&lt;/span>&lt;span class="o">=&lt;/span>audit&lt;span class="o">(&lt;/span>1743789169.017:1277&lt;span class="o">)&lt;/span>: &lt;span class="nv">pid&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span> &lt;span class="nv">uid&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">auid&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">4294967295&lt;/span> &lt;span class="nv">ses&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">4294967295&lt;/span> &lt;span class="nv">subj&lt;/span>&lt;span class="o">=&lt;/span>system_u:system_r:init_t:s0 &lt;span class="nv">msg&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;unit=machine-config-daemon-reboot comm=&amp;#34;systemd&amp;#34; exe=&amp;#34;/usr/lib/systemd/systemd&amp;#34; hostname=? addr=? terminal=? res=success&amp;#39;&lt;/span>^&lt;span class="o">]&lt;/span>&lt;span class="nv">UID&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;root&amp;#34;&lt;/span> &lt;span class="nv">AUID&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;unset&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">type&lt;/span>&lt;span class="o">=&lt;/span>SERVICE_STOP &lt;span class="nv">msg&lt;/span>&lt;span class="o">=&lt;/span>audit&lt;span class="o">(&lt;/span>1743789169.119:1278&lt;span class="o">)&lt;/span>: &lt;span class="nv">pid&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span> &lt;span class="nv">uid&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">auid&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">4294967295&lt;/span> &lt;span class="nv">ses&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">4294967295&lt;/span> &lt;span class="nv">subj&lt;/span>&lt;span class="o">=&lt;/span>system_u:system_r:init_t:s0 &lt;span class="nv">msg&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;unit=machine-config-daemon-reboot comm=&amp;#34;systemd&amp;#34; exe=&amp;#34;/usr/lib/systemd/systemd&amp;#34; hostname=? addr=? terminal=? res=success&amp;#39;&lt;/span>^&lt;span class="o">]&lt;/span>&lt;span class="nv">UID&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;root&amp;#34;&lt;/span> &lt;span class="nv">AUID&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;unset
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Furthermore this can be confirmed with the &lt;code>MachineConfigPool&lt;/code>, which provides us with the latest &lt;code>MachineConfig&lt;/code> &lt;code>rendered-worker-04636f9acf052beffabf57725a564095&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ oc get mcp worker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME CONFIG UPDATED UPDATING DEGRADED MACHINECOUNT READYMACHINECOUNT UPDATEDMACHINECOUNT DEGRADEDMACHINECOUNT AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">worker rendered-worker-04636f9acf052beffabf57725a564095 True False False &lt;span class="m">2&lt;/span> &lt;span class="m">2&lt;/span> &lt;span class="m">2&lt;/span> &lt;span class="m">0&lt;/span> 5d2h
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Looking at the boot IDs, we should see, that boot id &lt;code>57cdb3ac10fd46c3933a3f0ba3e3c33f&lt;/code> should be shutdown by the machine config operator with a message, that it will boot into &lt;code>rendered-worker-04636f9acf052beffabf57725a564095&lt;/code>. This is the case:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ journalctl --list-boots &lt;span class="p">|&lt;/span> tail -n &lt;span class="m">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -1 57cdb3ac10fd46c3933a3f0ba3e3c33f Fri 2025-04-04 07:47:43 UTC Fri 2025-04-04 17:53:13 UTC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">0&lt;/span> 6004e8be8fbc4d769485a991ff1641d4 Fri 2025-04-04 17:53:19 UTC Fri 2025-04-04 18:04:01 UTC
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ journalctl -u machine-config-daemon-reboot
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-- Boot 57cdb3ac10fd46c3933a3f0ba3e3c33f --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Apr &lt;span class="m">04&lt;/span> 17:52:49 compute-1 systemd&lt;span class="o">[&lt;/span>1&lt;span class="o">]&lt;/span>: Started machine-config-daemon: Node will reboot into config rendered-worker-04636f9acf052beffabf57725a564095.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Apr &lt;span class="m">04&lt;/span> 17:52:49 compute-1 systemd&lt;span class="o">[&lt;/span>1&lt;span class="o">]&lt;/span>: machine-config-daemon-reboot.service: Deactivated successfully.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Apr &lt;span class="m">04&lt;/span> 17:52:49 compute-1 systemd&lt;span class="o">[&lt;/span>1&lt;span class="o">]&lt;/span>: Stopped machine-config-daemon: Node will reboot into config rendered-worker-04636f9acf052beffabf57725a564095.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="case-3-a-container-with-elevated-privileges-was-compromised">Case 3: A container with elevated privileges was compromised
&lt;/h2>&lt;p>Some containers require elevated privileges to perform certain actions on OpenShift. If such a container is compromised, then a reboot could be initiated from the container. In this example I will be using a container of the &lt;code>Node Tuning Operator&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ oc -n openshift-cluster-node-tuning-operator get pods -owide
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cluster-node-tuning-operator-5bb647f57c-lk7wx 1/1 Running &lt;span class="m">0&lt;/span> 4d15h X.X.X.X master-1 &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tuned-5q7vm 1/1 Running &lt;span class="m">1&lt;/span> 4d15h X.X.X.X compute-0 &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tuned-8n89v 1/1 Running &lt;span class="m">1&lt;/span> 4d15h X.X.X.X compute-1 &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tuned-g7nwk 1/1 Running &lt;span class="m">0&lt;/span> 4d15h X.X.X.X master-0 &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tuned-rxt2q 1/1 Running &lt;span class="m">0&lt;/span> 4d15h X.X.X.X master-2 &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tuned-xsm98 1/1 Running &lt;span class="m">0&lt;/span> 4d15h X.X.X.X master-1 &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc -n openshift-cluster-node-tuning-operator rsh tuned-8n89v
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ id
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">uid&lt;/span>&lt;span class="o">=&lt;/span>0&lt;span class="o">(&lt;/span>root&lt;span class="o">)&lt;/span> &lt;span class="nv">gid&lt;/span>&lt;span class="o">=&lt;/span>0&lt;span class="o">(&lt;/span>root&lt;span class="o">)&lt;/span> &lt;span class="nv">groups&lt;/span>&lt;span class="o">=&lt;/span>0&lt;span class="o">(&lt;/span>root&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ date
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Fri Apr &lt;span class="m">4&lt;/span> 07:25:01 UTC &lt;span class="m">2025&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ reboot
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>One interesting fact here is, that we do not see this reboot in the &lt;code>audit.log&lt;/code>, as the last entry for a &lt;code>reboot&lt;/code> is the same as the one from &lt;code>Case 1&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ cat /var/log/audit/audit.log &lt;span class="p">|&lt;/span> grep reboot &lt;span class="p">|&lt;/span> tail -n &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">type&lt;/span>&lt;span class="o">=&lt;/span>USER_CMD &lt;span class="nv">msg&lt;/span>&lt;span class="o">=&lt;/span>audit&lt;span class="o">(&lt;/span>1743748835.979:805&lt;span class="o">)&lt;/span>: &lt;span class="nv">pid&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">1366614&lt;/span> &lt;span class="nv">uid&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">auid&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">4294967295&lt;/span> &lt;span class="nv">ses&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">4294967295&lt;/span> &lt;span class="nv">subj&lt;/span>&lt;span class="o">=&lt;/span>system_u:system_r:spc_t:s0 &lt;span class="nv">msg&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;cwd=&amp;#34;/&amp;#34; cmd=&amp;#34;reboot&amp;#34; exe=&amp;#34;/usr/bin/sudo&amp;#34; terminal=? res=success&amp;#39;&lt;/span>&lt;span class="nv">UID&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;root&amp;#34;&lt;/span> &lt;span class="nv">AUID&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;unset&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Nevertheless, we can see in the &lt;code>journalctl&lt;/code> that the &lt;code>reboot&lt;/code> was initiated. Please also note, that the reboot was initiated shortly after &lt;code>Fri Apr 4 07:25:01 UTC 2025&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ journalctl -b -1 &lt;span class="p">|&lt;/span> grep -i reboot &lt;span class="p">|&lt;/span> tail -n &lt;span class="m">3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Apr &lt;span class="m">04&lt;/span> 07:25:06 compute-1 systemd-logind&lt;span class="o">[&lt;/span>906&lt;span class="o">]&lt;/span>: The system will reboot now!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Apr &lt;span class="m">04&lt;/span> 07:25:06 compute-1 systemd-logind&lt;span class="o">[&lt;/span>906&lt;span class="o">]&lt;/span>: System is rebooting.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Apr &lt;span class="m">04&lt;/span> 07:26:41 compute-1 systemd&lt;span class="o">[&lt;/span>1&lt;span class="o">]&lt;/span>: Requested transaction contradicts existing jobs: Transaction &lt;span class="k">for&lt;/span> NetworkManager-dispatcher.service/start is destructive &lt;span class="o">(&lt;/span>reboot.target has &lt;span class="s1">&amp;#39;start&amp;#39;&lt;/span> job queued, but &lt;span class="s1">&amp;#39;stop&amp;#39;&lt;/span> is included in transaction&lt;span class="o">)&lt;/span>.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>While an audit rule might be helping to detect that the &lt;code>reboot&lt;/code> was started via &lt;code>/usr/sbin/reboot&lt;/code> from a container, this is probably not something of practical relevance.&lt;/p>
&lt;h2 id="case-4-the-hypervisor-triggered-a-soft-reboot">Case 4: The hypervisor triggered a soft reboot
&lt;/h2>&lt;p>To differentiate better between those cases, we will be using &lt;code>compute-0&lt;/code> for the reboots initiated by the hypervisor / cloud provider instead of &lt;code>compute-1&lt;/code>.
For a (kind of) graceful shutdown we will be using the &lt;code>virsh reboot&lt;/code> command. To provide a rough idea what this does, we can take a look at the man page for &lt;code>virsh reboot&lt;/code>:&lt;/p>
&lt;blockquote>
&lt;p>Reboot a domain. This acts just as if the domain had the reboot command run from the console. The command returns as soon as it has executed the reboot action, which may be significantly before the domain actually reboots.&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ date
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Fri Apr &lt;span class="m">4&lt;/span> 06:59:52 PM CEST &lt;span class="m">2025&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ virsh reboot ocp4-compute-0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Domain &lt;span class="s1">&amp;#39;ocp4-compute-0&amp;#39;&lt;/span> is being rebooted
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>We can find a related &lt;code>audit.log&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ ausearch -m SERVICE_STOP &lt;span class="p">|&lt;/span> grep -Ei &lt;span class="s1">&amp;#39;shutdownd|shutdown|reboot|final|auditd&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">type&lt;/span>&lt;span class="o">=&lt;/span>SERVICE_STOP &lt;span class="nv">msg&lt;/span>&lt;span class="o">=&lt;/span>audit&lt;span class="o">(&lt;/span>1743785996.839:279&lt;span class="o">)&lt;/span>: &lt;span class="nv">pid&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span> &lt;span class="nv">uid&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">auid&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">4294967295&lt;/span> &lt;span class="nv">ses&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">4294967295&lt;/span> &lt;span class="nv">subj&lt;/span>&lt;span class="o">=&lt;/span>system_u:system_r:init_t:s0 &lt;span class="nv">msg&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;unit=dracut-shutdown comm=&amp;#34;systemd&amp;#34; exe=&amp;#34;/usr/lib/systemd/systemd&amp;#34; hostname=? addr=? terminal=? res=success&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Additionally we see the shutdown process in the &lt;code>journalctl&lt;/code> of the previous boot:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ journalctl -b -1 &lt;span class="p">|&lt;/span> grep -i shutdown &lt;span class="p">|&lt;/span> tail -n &lt;span class="m">6&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Apr &lt;span class="m">04&lt;/span> 16:59:56 compute-0 systemd&lt;span class="o">[&lt;/span>1&lt;span class="o">]&lt;/span>: Stopping Restore /run/initramfs on shutdown...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Apr &lt;span class="m">04&lt;/span> 16:59:56 compute-0 systemd&lt;span class="o">[&lt;/span>1&lt;span class="o">]&lt;/span>: dracut-shutdown.service: Deactivated successfully.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Apr &lt;span class="m">04&lt;/span> 16:59:56 compute-0 systemd&lt;span class="o">[&lt;/span>1&lt;span class="o">]&lt;/span>: Stopped Restore /run/initramfs on shutdown.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Apr &lt;span class="m">04&lt;/span> 17:00:42 compute-0 systemd&lt;span class="o">[&lt;/span>1&lt;span class="o">]&lt;/span>: Requested transaction contradicts existing jobs: Transaction &lt;span class="k">for&lt;/span> NetworkManager-dispatcher.service/start is destructive &lt;span class="o">(&lt;/span>shutdown.target has &lt;span class="s1">&amp;#39;start&amp;#39;&lt;/span> job queued, but &lt;span class="s1">&amp;#39;stop&amp;#39;&lt;/span> is included in transaction&lt;span class="o">)&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Apr &lt;span class="m">04&lt;/span> 17:00:43 compute-0 systemd&lt;span class="o">[&lt;/span>1&lt;span class="o">]&lt;/span>: Stopping Record System Boot/Shutdown in UTMP...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Apr &lt;span class="m">04&lt;/span> 17:00:43 compute-0 systemd&lt;span class="o">[&lt;/span>1&lt;span class="o">]&lt;/span>: Stopped Record System Boot/Shutdown in UTMP.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Note: While the timezone configuration is different, those logs are related to the same &lt;code>virsh reboot&lt;/code>.&lt;/p>
&lt;h2 id="case-5-the-hypervisor-triggered-a-hard-reset">Case 5: The hypervisor triggered a hard reset
&lt;/h2>&lt;p>For this experiment we will be using the &lt;code>virsh reset&lt;/code> command. To provide a rough idea what this does, we can take a look at the man page for &lt;code>virsh reset&lt;/code>:&lt;/p>
&lt;blockquote>
&lt;p>Reset a domain immediately without any guest shutdown. reset emulates the power reset button on a machine, where all guest hardware sees the RST line set and reinitializes internal state.
Note: Reset without any guest OS shutdown risks data loss.&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ date
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Fri Apr &lt;span class="m">4&lt;/span> 07:17:45 PM CEST &lt;span class="m">2025&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ virsh reset ocp4-compute-0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Domain &lt;span class="s1">&amp;#39;ocp4-compute-0&amp;#39;&lt;/span> was reset
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>The only &lt;code>audit.log&lt;/code> we can find, is the one form before:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ ausearch -m SERVICE_STOP &lt;span class="p">|&lt;/span> grep -Ei &lt;span class="s1">&amp;#39;shutdownd|shutdown|reboot|final|auditd&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">type&lt;/span>&lt;span class="o">=&lt;/span>SERVICE_STOP &lt;span class="nv">msg&lt;/span>&lt;span class="o">=&lt;/span>audit&lt;span class="o">(&lt;/span>1743785996.839:279&lt;span class="o">)&lt;/span>: &lt;span class="nv">pid&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span> &lt;span class="nv">uid&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">auid&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">4294967295&lt;/span> &lt;span class="nv">ses&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">4294967295&lt;/span> &lt;span class="nv">subj&lt;/span>&lt;span class="o">=&lt;/span>system_u:system_r:init_t:s0 &lt;span class="nv">msg&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;unit=dracut-shutdown comm=&amp;#34;systemd&amp;#34; exe=&amp;#34;/usr/lib/systemd/systemd&amp;#34; hostname=? addr=? terminal=? res=success&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>The &lt;code>journalctl&lt;/code> of the previous boot also suddenly ends without a shutdown sequence:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ journalctl -b -1 &lt;span class="p">|&lt;/span> tail -n &lt;span class="m">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Apr &lt;span class="m">04&lt;/span> 17:16:11 compute-0 systemd&lt;span class="o">[&lt;/span>1&lt;span class="o">]&lt;/span>: Finished Cleanup of Temporary Directories.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Apr &lt;span class="m">04&lt;/span> 17:16:11 compute-0 systemd&lt;span class="o">[&lt;/span>1&lt;span class="o">]&lt;/span>: run-credentials-systemd&lt;span class="se">\x&lt;/span>2dtmpfiles&lt;span class="se">\x&lt;/span>2dclean.service.mount: Deactivated successfully.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Note: The shutdown was initiated at &lt;code>17:17:45&lt;/code> when considering the different timezone configurations.&lt;/p>
&lt;p>Nevertheless, we can have an indicator, that the previous boot had an unclean shutdown by seeing if there was&lt;/p>
&lt;ul>
&lt;li>A recovery started during latest boot&lt;/li>
&lt;li>A filesystem check initiated during latest boot.&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ journalctl -b &lt;span class="m">0&lt;/span> &lt;span class="p">|&lt;/span> grep -iE &lt;span class="s1">&amp;#39;recover|fsck&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Apr &lt;span class="m">04&lt;/span> 17:17:58 localhost systemd-fsck&lt;span class="o">[&lt;/span>651&lt;span class="o">]&lt;/span>: /usr/sbin/fsck.xfs: XFS file system.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Apr &lt;span class="m">04&lt;/span> 17:17:58 localhost kernel: XFS &lt;span class="o">(&lt;/span>vda4&lt;span class="o">)&lt;/span>: Starting recovery &lt;span class="o">(&lt;/span>logdev: internal&lt;span class="o">)&lt;/span> &amp;lt;&lt;span class="o">=====&lt;/span> HERE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Apr &lt;span class="m">04&lt;/span> 17:17:58 localhost kernel: XFS &lt;span class="o">(&lt;/span>vda4&lt;span class="o">)&lt;/span>: Ending recovery &lt;span class="o">(&lt;/span>logdev: internal&lt;span class="o">)&lt;/span> &amp;lt;&lt;span class="o">=====&lt;/span> HERE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Apr &lt;span class="m">04&lt;/span> 17:17:59 compute-0 systemd&lt;span class="o">[&lt;/span>1&lt;span class="o">]&lt;/span>: Created slice Slice /system/systemd-fsck.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Apr &lt;span class="m">04&lt;/span> 17:17:59 compute-0 systemd&lt;span class="o">[&lt;/span>1&lt;span class="o">]&lt;/span>: systemd-fsck-root.service: Deactivated successfully.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Apr &lt;span class="m">04&lt;/span> 17:18:00 compute-0 systemd-fsck&lt;span class="o">[&lt;/span>819&lt;span class="o">]&lt;/span>: boot: recovering journal &amp;lt;&lt;span class="o">=====&lt;/span> HERE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Apr &lt;span class="m">04&lt;/span> 17:18:00 compute-0 systemd-fsck&lt;span class="o">[&lt;/span>819&lt;span class="o">]&lt;/span>: boot: clean, 365/98304 files, 150426/393216 blocks
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>We see that the system did not go through a normal shutdown sequence due to the presence of &lt;code>XFS&lt;/code> recovery and &lt;code>fsck&lt;/code> journal recovery which confirms that filesystems were not cleanly unmounted. See the &lt;code>unclean unmounts&lt;/code> section in the &lt;a class="link" href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/9/html/managing_file_systems/checking-and-repairing-a-file-system__managing-file-systems#error-handling-mechanisms-in-xfs_checking-and-repairing-a-file-system" target="_blank" rel="noopener"
>RHEL 9 docs for XFS&lt;/a>.&lt;/p>
&lt;h2 id="case-6-a-kernel-panic-occured">Case 6: A kernel panic occured
&lt;/h2>&lt;p>A kernel panic is a safety measure taken by the kernel of an operating system when an internal fatal error is detected, such as hardware failures and memory corruption. First we need to clarify, if a system would reboot in such a case. The responsible setting is &lt;code>kernel.panic&lt;/code>, where &lt;code>0&lt;/code> means that the system is not rebooted. Any other value indicates the number of seconds which are waited before the reboot is triggered, see further &lt;a class="link" href="https://docs.kernel.org/admin-guide/sysctl/kernel.html#panic" target="_blank" rel="noopener"
>kernel docs&lt;/a>.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ sysctl kernel.panic
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kernel.panic &lt;span class="o">=&lt;/span> &lt;span class="m">10&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>If a kernel panic would have happened, we would usually find a corresponding file in &lt;code>/sys/fs/pstore/&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ ls /sys/fs/pstore/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sh-5.1#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>As the setup here is a bit more complicated for OpenShift, I will leave it without an example. For further readings, please follow the &lt;a class="link" href="https://docs.kernel.org/admin-guide/pstore-blk.html" target="_blank" rel="noopener"
>kernel docs&lt;/a>.&lt;/p>
&lt;h2 id="conclusion">Conclusion
&lt;/h2>&lt;p>Linux offers many powerful utilities to understand what has happened on your system. This includes user initiated actions, hypervisor / cloud provider activity and even hardware failures. If you have other indicators which you are usually verifying, please let me know.&lt;/p></description></item><item><title>KubeVirt with libvirt/QEMU/KVM in Kind</title><link>https://www.niederwanger.dev/p/kubevirt-to-run-vms-on-k8s/</link><pubDate>Tue, 18 Feb 2025 00:00:00 +0000</pubDate><guid>https://www.niederwanger.dev/p/kubevirt-to-run-vms-on-k8s/</guid><description>&lt;img src="https://www.niederwanger.dev/p/kubevirt-to-run-vms-on-k8s/cover.png" alt="Featured image of post KubeVirt with libvirt/QEMU/KVM in Kind" />&lt;h2 id="bridging-the-gap-between-virtual-machines-and-kubernetes-with-kubevirt">Bridging the Gap Between Virtual Machines and Kubernetes with KubeVirt
&lt;/h2>&lt;p>This blog post will provide a brief introduction to the open source &lt;a class="link" href="https://www.cncf.io/" target="_blank" rel="noopener"
>CNCF&lt;/a> project &lt;a class="link" href="https://kubevirt.io/" target="_blank" rel="noopener"
>KubeVirt&lt;/a>. KubeVirt (alongside &lt;a class="link" href="https://linux-kvm.org/page/Main_Page" target="_blank" rel="noopener"
>Kernel-based Virtual Machine (KVM)&lt;/a>/&lt;a class="link" href="https://libvirt.org/" target="_blank" rel="noopener"
>libvirt&lt;/a>/&lt;a class="link" href="https://www.qemu.org/" target="_blank" rel="noopener"
>QEMU&lt;/a>) is one of the foundational components included in &lt;a class="link" href="https://www.redhat.com/en/technologies/cloud-computing/openshift/virtualization" target="_blank" rel="noopener"
>OpenShift Virtualization&lt;/a>. A more detailed relationship can be found on the &lt;a class="link" href="https://github.com/kubevirt/hyperconverged-cluster-operator" target="_blank" rel="noopener"
>Hyperconverged Cluster Operator&lt;/a> for OpenShift Container Platform (OCP). While this blog post shall be focused on the upstream project KubeVirt, I have to provided full credit to OpenShift Virtualization along the lines, because most of my lessons learned are originated there.&lt;/p>
&lt;blockquote>
&lt;p>&lt;strong>If you are just interested in the demo, please head over to section &lt;a class="link" href="#kubevirt-with-libvirtqemukvm-in-kind" >KubeVirt with libvirt/QEMU/KVM in kind&lt;/a>.&lt;/strong>&lt;/p>&lt;/blockquote>
&lt;h2 id="why-kubevirt--openshift-virtualization">Why KubeVirt / OpenShift Virtualization?
&lt;/h2>&lt;p>&lt;a class="link" href="https://kubevirt.io/" target="_blank" rel="noopener"
>KubeVirt&lt;/a> / OpenShift Virtualization allows you to operate virtual machines (VMs) on &lt;a class="link" href="https://kubernetes.io/" target="_blank" rel="noopener"
>Kubernetes&lt;/a> / &lt;a class="link" href="https://www.redhat.com/en/technologies/cloud-computing/openshift" target="_blank" rel="noopener"
>OpenShift&lt;/a>. I have come across several different reasons why companies would want to look into this topic. Please let me elaborate on some reasons:&lt;/p>
&lt;ul>
&lt;li>Migrate VMs to microservices at your pace
&lt;ul>
&lt;li>KubeVirt / OpenShift Virtualization can be an interim solution when you are migrating your workloads towards containers anyway and need to host them on your k8s based platform temporary. This is especially true when you are using the &lt;a class="link" href="https://docs.redhat.com/en/documentation/migration_toolkit_for_virtualization/latest/html/installing_and_using_the_migration_toolkit_for_virtualization/index" target="_blank" rel="noopener"
>Migration Toolkit for Virtualization&lt;/a> on OpenShift for the initial migration.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Legacy applications need VMs
&lt;ul>
&lt;li>Some applications might not be worth to modernize to container technology as their is no commercial benefit. Thus you will leave them as is in a VM until the end of the application lifecycle.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Reduce technology spread (Hypervisor + K8s / OCP)
&lt;ul>
&lt;li>Some companies are looking for a way to reduce the technology spread in their existing infrastructure.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Replace hypervisor and save costs $$$
&lt;ul>
&lt;li>The layer of a hypervisor is introducing additional costs on your infrastructure which can be avoided when using kubernetes / OpenShift on bare metal servers.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Need virtualization technology for certain requirements
&lt;ul>
&lt;li>Companies could be forced to use virtualization technology to comply with some of their requirements, especially in the realm of public and critical infrastructure.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="why-openshift-virtualization-instead-of-upstream-kubevirt">Why OpenShift Virtualization instead of upstream KubeVirt?
&lt;/h2>&lt;p>From the above reasons you could think that OpenShift Virtualization might be fully interchangeable with KubeVirt. Nevertheless there are some key differences:&lt;/p>
&lt;ul>
&lt;li>OpenShift Virtualization is running on OpenShift thus uses &lt;a class="link" href="https://docs.redhat.com/en/documentation/openshift_container_platform/latest/html/architecture/architecture-rhcos" target="_blank" rel="noopener"
>Red Hat Enterprise Linux CoreOS (RHCOS)&lt;/a> as the underlying operating system.
&lt;ul>
&lt;li>RHCOS is the downstream version of &lt;a class="link" href="https://fedoraproject.org/coreos/" target="_blank" rel="noopener"
>Fedora CoreOS&lt;/a>.&lt;/li>
&lt;li>Red Hat has a very long and successful history with
&lt;ul>
&lt;li>Red Hat Enterprise Linux (RHEL) and&lt;/li>
&lt;li>Virtualization with the &lt;a class="link" href="https://linux-kvm.org/page/Main_Page" target="_blank" rel="noopener"
>KVM&lt;/a>/&lt;a class="link" href="https://libvirt.org/" target="_blank" rel="noopener"
>libvirt&lt;/a>/&lt;a class="link" href="https://www.qemu.org/" target="_blank" rel="noopener"
>QEMU&lt;/a> stack in &lt;a class="link" href="https://en.wikipedia.org/wiki/Red_Hat_Virtualization" target="_blank" rel="noopener"
>Red Hat Virtualization&lt;/a> and &lt;a class="link" href="https://access.redhat.com/products/red-hat-openstack-platform" target="_blank" rel="noopener"
>Red Hat OpenStack Platform&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>OpenShift has full commercial support from Red Hat. This includes multi-vendor support which can be relevant especially when you are facing issues on the storage side.&lt;/li>
&lt;li>OpenShift Virtualization can be easily setup and managed throughout the lifecycle via the &lt;a class="link" href="https://olm.operatorframework.io/" target="_blank" rel="noopener"
>Operator Lifecycle Manager&lt;/a> on OpenShift.&lt;/li>
&lt;/ul>
&lt;h2 id="how-does-kubevirt-work">How does KubeVirt work?
&lt;/h2>&lt;p>A detailed explanation about KubeVirt can be found on the official &lt;a class="link" href="https://kubevirt.io/user-guide/architecture/" target="_blank" rel="noopener"
>KubeVirt website&lt;/a>. Simply put, KubeVirt will provide a &lt;code>Controller&lt;/code> and &lt;code>API&lt;/code> server on the control plane and some &lt;code>Agents&lt;/code> on the worker nodes. You can interact with the custom resources via the kubernetes API server which will allow you to interact with the virtual machines. The virtual machines are created via the &lt;a class="link" href="https://libvirt.org/" target="_blank" rel="noopener"
>libvirt&lt;/a> daemon which leverages &lt;a class="link" href="https://www.qemu.org/" target="_blank" rel="noopener"
>QEMU&lt;/a> and the &lt;a class="link" href="https://linux-kvm.org/page/Main_Page" target="_blank" rel="noopener"
>KVM&lt;/a> components on Linux.&lt;/p>
&lt;p>&lt;img src="https://kubevirt.io/user-guide/assets/architecture-simple.png"
loading="lazy"
>
&lt;img src="https://kubevirt.io/user-guide/assets/architecture.png"
loading="lazy"
>&lt;/p>
&lt;h2 id="kubevirt-with-libvirtqemukvm-in-kind">KubeVirt with libvirt/QEMU/KVM in kind
&lt;/h2>&lt;p>Before we move ahead make sure to provision the setup on a linux machine, because there you will have access to the libvirt/QEMU/KVM stack. Other platform, e.g. MacOS, might use other hypervisor technology and you could run into issues. More specifically, you might run into &lt;a class="link" href="https://github.com/kubevirt/kubevirt/issues/11917" target="_blank" rel="noopener"
>kubevirt/issues/11917&lt;/a> on Apple hardware.&lt;/p>
&lt;h3 id="setup-kind-and-kubevirt">Setup kind and KubeVirt
&lt;/h3>&lt;p>To setup your machine please follow these instructions:&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://kubernetes.io/docs/tasks/tools/" target="_blank" rel="noopener"
>Setup &lt;code>kubectl&lt;/code>&lt;/a>&lt;/li>
&lt;li>While I generally advocate for the &lt;a class="link" href="https://podman.io/docs/installation" target="_blank" rel="noopener"
>rootless &lt;code>Podman&lt;/code>&lt;/a>, it is easier to get started with the &lt;a class="link" href="https://docs.docker.com/engine/install/" target="_blank" rel="noopener"
>&lt;code>Docker&lt;/code> driver&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://kind.sigs.k8s.io/docs/user/quick-start/#installation" target="_blank" rel="noopener"
>Setup &lt;code>kind&lt;/code>&lt;/a>&lt;/li>
&lt;li>Install &lt;code>virtctl&lt;/code> a &lt;a class="link" href="https://kubevirt.io/quickstart_kind/" target="_blank" rel="noopener"
>binary from the KubeVirt project to manage the VMs&lt;/a>
&lt;ul>
&lt;li>Via Github
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">VERSION&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">$(&lt;/span>curl -s https://storage.googleapis.com/kubevirt-prow/release/kubevirt/kubevirt/stable.txt&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">ARCH&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">$(&lt;/span>uname -s &lt;span class="p">|&lt;/span> tr A-Z a-z&lt;span class="k">)&lt;/span>-&lt;span class="k">$(&lt;/span>uname -m &lt;span class="p">|&lt;/span> sed &lt;span class="s1">&amp;#39;s/x86_64/amd64/&amp;#39;&lt;/span>&lt;span class="k">)&lt;/span> &lt;span class="o">||&lt;/span> windows-amd64.exe
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="si">${&lt;/span>&lt;span class="nv">ARCH&lt;/span>&lt;span class="si">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -L -o virtctl https://github.com/kubevirt/kubevirt/releases/download/&lt;span class="si">${&lt;/span>&lt;span class="nv">VERSION&lt;/span>&lt;span class="si">}&lt;/span>/virtctl-&lt;span class="si">${&lt;/span>&lt;span class="nv">VERSION&lt;/span>&lt;span class="si">}&lt;/span>-&lt;span class="si">${&lt;/span>&lt;span class="nv">ARCH&lt;/span>&lt;span class="si">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">chmod +x virtctl
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo install virtctl /usr/local/bin
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>Via &lt;a class="link" href="https://github.com/kubernetes-sigs/krew/" target="_blank" rel="noopener"
>&lt;code>krew&lt;/code>&lt;/a>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">kubectl krew install virt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Install the libvirt/QEMU/KVM stack for your linux distribution. For Fedora you can find a &lt;a class="link" href="https://docs.fedoraproject.org/en-US/quick-docs/virtualization-getting-started/#_installing_virtualization_software" target="_blank" rel="noopener"
>guide here&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="provision-kind-cluster-with-kubevirt">Provision kind cluster with KubeVirt
&lt;/h3>&lt;p>First of all we create a cluster with one &lt;code>control-plane&lt;/code> node and two &lt;code>worker&lt;/code> nodes:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">cat &lt;span class="s">&amp;lt;&amp;lt; EOF &amp;gt; kind-config.yaml
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">kind: Cluster
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">apiVersion: kind.x-k8s.io/v1alpha4
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">nodes:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">- role: control-plane
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">- role: worker
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">- role: worker
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Then we create a &lt;code>bash&lt;/code> script which does the following:&lt;/p>
&lt;ul>
&lt;li>Create a &lt;code>kind&lt;/code> cluster with the &lt;code>kind-config.yaml&lt;/code> config&lt;/li>
&lt;li>Following the &lt;a class="link" href="https://kubevirt.io/quickstart_kind/" target="_blank" rel="noopener"
>kubevirt instructions&lt;/a> to install the kubevirt operator&lt;/li>
&lt;li>Following the &lt;a class="link" href="https://kubevirt.io/labs/kubernetes/lab1.html" target="_blank" rel="noopener"
>kubevirt lab&lt;/a> to provision and start an ephemeral &lt;a class="link" href="https://kubevirt.io/user-guide/storage/disks_and_volumes/#containerdisk" target="_blank" rel="noopener"
>container disk&lt;/a> VM&lt;/li>
&lt;li>Following the &lt;a class="link" href="https://kubevirt.io/labs/kubernetes/lab2.html" target="_blank" rel="noopener"
>kubevirt instructions on Containerized Data Importer (CDI) operator&lt;/a> to provision a persistent VM&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;span class="lnt">74
&lt;/span>&lt;span class="lnt">75
&lt;/span>&lt;span class="lnt">76
&lt;/span>&lt;span class="lnt">77
&lt;/span>&lt;span class="lnt">78
&lt;/span>&lt;span class="lnt">79
&lt;/span>&lt;span class="lnt">80
&lt;/span>&lt;span class="lnt">81
&lt;/span>&lt;span class="lnt">82
&lt;/span>&lt;span class="lnt">83
&lt;/span>&lt;span class="lnt">84
&lt;/span>&lt;span class="lnt">85
&lt;/span>&lt;span class="lnt">86
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> -euo pipefail &lt;span class="c1"># Enable strict error handling&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Define color codes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">RED&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;\033[0;31m&amp;#39;&lt;/span> &lt;span class="c1"># Red (Errors)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">GREEN&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;\033[0;32m&amp;#39;&lt;/span> &lt;span class="c1"># Green (Success)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">YELLOW&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;\033[0;33m&amp;#39;&lt;/span> &lt;span class="c1"># Yellow (Warnings)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">BLUE&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;\033[0;34m&amp;#39;&lt;/span> &lt;span class="c1"># Blue (Info)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">NC&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;\033[0m&amp;#39;&lt;/span> &lt;span class="c1"># No Color (Reset)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Function to check if a command exists&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">command_exists&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">command&lt;/span> -v &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$1&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &amp;gt;/dev/null 2&amp;gt;&lt;span class="p">&amp;amp;&lt;/span>&lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Ensure required commands are installed&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> cmd in kind kubectl curl virtctl&lt;span class="p">;&lt;/span> &lt;span class="k">do&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> ! command_exists &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$cmd&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> -e &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">RED&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">Error: &amp;#39;&lt;/span>&lt;span class="nv">$cmd&lt;/span>&lt;span class="s2">&amp;#39; is not installed. Please install it before running this script.&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">NC&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">exit&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">done&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> -e &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">BLUE&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">Creating Kubernetes cluster...&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">NC&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kind create cluster --config&lt;span class="o">=&lt;/span>kind-config.yaml &lt;span class="o">||&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="nb">echo&lt;/span> -e &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">RED&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">Failed to create cluster&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">NC&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nb">exit&lt;/span> 1&lt;span class="p">;&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> -e &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">BLUE&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">Fetching latest KubeVirt version...&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">NC&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">VERSION&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">$(&lt;/span>curl -fsSL https://storage.googleapis.com/kubevirt-prow/release/kubevirt/kubevirt/stable.txt&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> -e &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">GREEN&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">Using KubeVirt version: &lt;/span>&lt;span class="nv">$VERSION&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">NC&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> -e &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">BLUE&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">Deploying KubeVirt operator...&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">NC&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kubectl apply -f &lt;span class="s2">&amp;#34;https://github.com/kubevirt/kubevirt/releases/download/&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">VERSION&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">/kubevirt-operator.yaml&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> -e &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">BLUE&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">Waiting for KubeVirt operator to be ready...&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">NC&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kubectl &lt;span class="nb">wait&lt;/span> --for&lt;span class="o">=&lt;/span>&lt;span class="nv">condition&lt;/span>&lt;span class="o">=&lt;/span>available --timeout&lt;span class="o">=&lt;/span>120s -n kubevirt deployments -l kubevirt.io
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> -e &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">BLUE&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">Deploying KubeVirt custom resource...&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">NC&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kubectl apply -f &lt;span class="s2">&amp;#34;https://github.com/kubevirt/kubevirt/releases/download/&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">VERSION&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">/kubevirt-cr.yaml&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> -e &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">BLUE&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">Waiting for KubeVirt to be fully initialized...&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">NC&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kubectl &lt;span class="nb">wait&lt;/span> --for&lt;span class="o">=&lt;/span>&lt;span class="nv">condition&lt;/span>&lt;span class="o">=&lt;/span>Available --timeout&lt;span class="o">=&lt;/span>300s kubevirt/kubevirt -n kubevirt &lt;span class="o">||&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> -e &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">RED&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">KubeVirt deployment failed!&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">NC&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">exit&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">VM_MANIFEST&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;https://kubevirt.io/labs/manifests/vm.yaml&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> -e &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">BLUE&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">Applying Virtual Machine manifest from &lt;/span>&lt;span class="nv">$VM_MANIFEST&lt;/span>&lt;span class="s2">...&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">NC&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kubectl apply -f &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$VM_MANIFEST&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Show VM YAML if &amp;#39;bat&amp;#39; is installed&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> command_exists bat&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> -e &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">BLUE&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">Displaying VM manifest...&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">NC&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> curl -s &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$VM_MANIFEST&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="p">|&lt;/span> bat --language yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Wait briefly for the VM to be registered&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sleep &lt;span class="m">5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> -e &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">BLUE&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">Starting test VM...&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">NC&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">virtctl start testvm &lt;span class="o">||&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="nb">echo&lt;/span> -e &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">RED&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">Failed to start VM&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">NC&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nb">exit&lt;/span> 1&lt;span class="p">;&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> -e &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">GREEN&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2"> KubeVirt setup complete. Test VM started successfully!&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">NC&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ---------------------------------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Containerized Data Importer (CDI) Deployment&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ---------------------------------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> -e &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">BLUE&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">Fetching latest Containerized Data Importer (CDI) version...&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">NC&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">TAG&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">$(&lt;/span>curl -s -w %&lt;span class="o">{&lt;/span>redirect_url&lt;span class="o">}&lt;/span> https://github.com/kubevirt/containerized-data-importer/releases/latest&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">VERSION&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">$(&lt;/span>&lt;span class="nb">echo&lt;/span> &lt;span class="si">${&lt;/span>&lt;span class="nv">TAG&lt;/span>&lt;span class="p">##*/&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> -e &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">GREEN&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">Using CDI version: &lt;/span>&lt;span class="nv">$VERSION&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">NC&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> -e &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">BLUE&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">Deploying CDI operator...&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">NC&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kubectl apply -f &lt;span class="s2">&amp;#34;https://github.com/kubevirt/containerized-data-importer/releases/download/&lt;/span>&lt;span class="nv">$VERSION&lt;/span>&lt;span class="s2">/cdi-operator.yaml&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> -e &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">BLUE&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">Deploying CDI custom resource...&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">NC&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kubectl apply -f &lt;span class="s2">&amp;#34;https://github.com/kubevirt/containerized-data-importer/releases/download/&lt;/span>&lt;span class="nv">$VERSION&lt;/span>&lt;span class="s2">/cdi-cr.yaml&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> -e &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">BLUE&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">Waiting for CDI to be fully initialized...&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">NC&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kubectl &lt;span class="nb">wait&lt;/span> --for&lt;span class="o">=&lt;/span>&lt;span class="nv">condition&lt;/span>&lt;span class="o">=&lt;/span>Available --timeout&lt;span class="o">=&lt;/span>300s cdi/cdi -n cdi &lt;span class="o">||&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> -e &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">RED&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">CDI deployment failed!&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">NC&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">exit&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> -e &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">GREEN&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">CDI setup complete!&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">NC&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="experimenting-with-the-containerdisk-vm">Experimenting with the containerdisk VM
&lt;/h3>&lt;p>After executing the above &lt;code>bash&lt;/code> script we should have the following &lt;code>nodes&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ kubectl get nodes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">AME STATUS ROLES AGE VERSION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kind-control-plane Ready control-plane 22h v1.32.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kind-worker Ready &amp;lt;none&amp;gt; 22h v1.32.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kind-worker2 Ready &amp;lt;none&amp;gt; 22h v1.32.0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>We have applied the following &lt;code>VirtualMachine&lt;/code> to the cluster:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">kubevirt.io/v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">VirtualMachine&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">testvm&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">runStrategy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Halted&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">template&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">kubevirt.io/size&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">small&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">kubevirt.io/domain&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">testvm&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">domain&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">devices&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">disks&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">containerdisk&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">disk&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">bus&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">virtio&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">cloudinitdisk&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">disk&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">bus&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">virtio&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">interfaces&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">default&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">masquerade&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>{}&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">resources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">requests&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">memory&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">64M&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">networks&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">default&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">pod&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>{}&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">volumes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">containerdisk&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">containerDisk&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">quay.io/kubevirt/cirros-container-disk-demo&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">cloudinitdisk&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">cloudInitNoCloud&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">userDataBase64&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">SGkuXG4=&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>This is a &lt;code>VirtualMachine&lt;/code> which uses a &lt;code>containerDisk&lt;/code>. A &lt;code>containerDisk&lt;/code> is a ephemeral VM disk from a container image registry. We have not claimed any persistent storage with this &lt;code>VirtualMachine&lt;/code>. Consequently will a &lt;code>reboot&lt;/code> of this VM also result in a loss of all data.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ kubectl get pvc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">No resources found in default namespace
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Despite the fact, that the use of a &lt;code>containerDisk&lt;/code> is not the main goal of &lt;code>KubeVirt&lt;/code>, we can still use this &lt;code>VirtualMachine&lt;/code> to understand the behaviour of &lt;code>KubeVirt&lt;/code> components.&lt;/p>
&lt;p>There should be a &lt;code>VirtualMachine&lt;/code> in &lt;code>Running&lt;/code> state:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ kubectl get virtualmachine
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME AGE STATUS READY
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">testvm 22h Running True
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>When a &lt;code>VirtualMachine&lt;/code> is running, then there should also be a &lt;code>VirtualMachineInstance&lt;/code> with the exact same name &lt;code>testvm&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ kubectl get virtualmachineinstance
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME AGE PHASE IP NODENAME READY
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">testvm 20h Running 10.244.2.16 kind-worker True
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>The &lt;code>VirtualMachine&lt;/code> is actually running inside the &lt;code>virt-launcher-testvm-65f42&lt;/code> &lt;code>Pod&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ kubectl get pods
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">virt-launcher-testvm-65f42 3/3 Running &lt;span class="m">0&lt;/span> 20h
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>We can now check which processes are running inside this &lt;code>virt-launcher-testvm-65f42&lt;/code> &lt;code>Pod&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ kubectl &lt;span class="nb">exec&lt;/span> -it &lt;span class="k">$(&lt;/span>kubectl get pod -l&lt;span class="o">=&lt;/span>vm.kubevirt.io/name&lt;span class="o">=&lt;/span>testvm -o custom-columns&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;:metadata.name&amp;#39;&lt;/span> --no-headers&lt;span class="k">)&lt;/span> -- ps -ef
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">UID PID PPID C STIME TTY TIME CMD
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">qemu &lt;span class="m">1&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="m">0&lt;/span> Feb16 ? 00:00:00 /usr/bin/virt-launcher-monitor --qemu-timeout 312s --name testvm --uid a726afe8-d14f-4930-8240-86b47a25b547 --namespace
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">default --kubevirt-share-dir /var/run/kubevirt --ephemeral-disk-dir /var/run/kubevirt-ephemeral-disks --container-disk-dir /var/run/kubevirt/container-disks --grace-period-
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">seconds &lt;span class="m">45&lt;/span> --hook-sidecars &lt;span class="m">0&lt;/span> --ovmf-path /usr/share/OVMF --run-as-nonroot
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">qemu &lt;span class="m">19&lt;/span> &lt;span class="m">1&lt;/span> &lt;span class="m">0&lt;/span> Feb16 ? 00:00:24 /usr/bin/virt-launcher --qemu-timeout 312s --name testvm --uid a726afe8-d14f-4930-8240-86b47a25b547 --namespace default
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--kubevirt-share-dir /var/run/kubevirt --ephemeral-disk-dir /var/run/kubevirt-ephemeral-disks --container-disk-dir /var/run/kubevirt/container-disks --grace-period-seconds
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">45&lt;/span> --hook-sidecars &lt;span class="m">0&lt;/span> --ovmf-path /usr/share/OVMF --run-as-nonroot
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">qemu &lt;span class="m">31&lt;/span> &lt;span class="m">19&lt;/span> &lt;span class="m">0&lt;/span> Feb16 ? 00:00:02 /usr/sbin/virtqemud -f /var/run/libvirt/virtqemud.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">qemu &lt;span class="m">32&lt;/span> &lt;span class="m">19&lt;/span> &lt;span class="m">0&lt;/span> Feb16 ? 00:00:00 /usr/sbin/virtlogd -f /etc/libvirt/virtlogd.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">qemu &lt;span class="m">89&lt;/span> &lt;span class="m">1&lt;/span> &lt;span class="m">0&lt;/span> Feb16 ? 00:00:21 /usr/libexec/qemu-kvm -name &lt;span class="nv">guest&lt;/span>&lt;span class="o">=&lt;/span>default_testvm,debug-threads&lt;span class="o">=&lt;/span>on -S -object &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;qom-type&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;secret&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;id&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;masterKey0&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;for
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">mat&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;raw&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;file&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;/var/run/kubevirt-private/libvirt/qemu/lib/domain-1-default_testvm/master-key.aes&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> -machine pc-q35-rhel9.4.0,usb&lt;span class="o">=&lt;/span>off,dump-guest-core&lt;span class="o">=&lt;/span>off,memory-backend&lt;span class="o">=&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pc.ram,acpi&lt;span class="o">=&lt;/span>on -accel kvm -cpu Haswell-noTSX-IBRS,vmx&lt;span class="o">=&lt;/span>on,pdcm&lt;span class="o">=&lt;/span>on,f16c&lt;span class="o">=&lt;/span>on,rdrand&lt;span class="o">=&lt;/span>on,hypervisor&lt;span class="o">=&lt;/span>on,vme&lt;span class="o">=&lt;/span>on,ss&lt;span class="o">=&lt;/span>on,arat&lt;span class="o">=&lt;/span>on,tsc-adjust&lt;span class="o">=&lt;/span>on,umip&lt;span class="o">=&lt;/span>on,md-clear&lt;span class="o">=&lt;/span>on,stibp&lt;span class="o">=&lt;/span>on,flush-l1d&lt;span class="o">=&lt;/span>o
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">n,arch-capabilities&lt;span class="o">=&lt;/span>on,ssbd&lt;span class="o">=&lt;/span>on,xsaveopt&lt;span class="o">=&lt;/span>on,abm&lt;span class="o">=&lt;/span>on,pdpe1gb&lt;span class="o">=&lt;/span>on,ibpb&lt;span class="o">=&lt;/span>on,ibrs&lt;span class="o">=&lt;/span>on,amd-stibp&lt;span class="o">=&lt;/span>on,amd-ssbd&lt;span class="o">=&lt;/span>on,skip-l1dfl-vmentry&lt;span class="o">=&lt;/span>on,pschange-mc-no&lt;span class="o">=&lt;/span>on,gds-no&lt;span class="o">=&lt;/span>on,vmx-ins-outs&lt;span class="o">=&lt;/span>on,vmx-
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">true-ctls&lt;span class="o">=&lt;/span>on,vmx-store-lma&lt;span class="o">=&lt;/span>on,vmx-activity-hlt&lt;span class="o">=&lt;/span>on,vmx-activity-wait-sipi&lt;span class="o">=&lt;/span>on,vmx-vmwrite-vmexit-fields&lt;span class="o">=&lt;/span>on,vmx-apicv-xapic&lt;span class="o">=&lt;/span>on,vmx-ept&lt;span class="o">=&lt;/span>on,vmx-desc-exit&lt;span class="o">=&lt;/span>on,vmx-rdtscp-exit&lt;span class="o">=&lt;/span>on,v
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mx-apicv-x2apic&lt;span class="o">=&lt;/span>on,vmx-vpid&lt;span class="o">=&lt;/span>on,vmx-wbinvd-exit&lt;span class="o">=&lt;/span>on,vmx-unrestricted-guest&lt;span class="o">=&lt;/span>on,vmx-apicv-register&lt;span class="o">=&lt;/span>on,vmx-apicv-vid&lt;span class="o">=&lt;/span>on,vmx-rdrand-exit&lt;span class="o">=&lt;/span>on,vmx-invpcid-exit&lt;span class="o">=&lt;/span>on,vmx-vmfunc&lt;span class="o">=&lt;/span>on,vmx-
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">shadow-vmcs&lt;span class="o">=&lt;/span>on,vmx-pml&lt;span class="o">=&lt;/span>on,vmx-ept-execonly&lt;span class="o">=&lt;/span>on,vmx-page-walk-4&lt;span class="o">=&lt;/span>on,vmx-ept-2mb&lt;span class="o">=&lt;/span>on,vmx-ept-1gb&lt;span class="o">=&lt;/span>on,vmx-invept&lt;span class="o">=&lt;/span>on,vmx-eptad&lt;span class="o">=&lt;/span>on,vmx-invept-single-context&lt;span class="o">=&lt;/span>on,vmx-invept-all-contex
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">t&lt;/span>&lt;span class="o">=&lt;/span>on,vmx-invvpid&lt;span class="o">=&lt;/span>on,vmx-invvpid-single-addr&lt;span class="o">=&lt;/span>on,vmx-invvpid-all-context&lt;span class="o">=&lt;/span>on,vmx-intr-exit&lt;span class="o">=&lt;/span>on,vmx-nmi-exit&lt;span class="o">=&lt;/span>on,vmx-vnmi&lt;span class="o">=&lt;/span>on,vmx-preemption-timer&lt;span class="o">=&lt;/span>on,vmx-posted-intr&lt;span class="o">=&lt;/span>on,vmx-vintr-
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">pending&lt;/span>&lt;span class="o">=&lt;/span>on,vmx-tsc-offset&lt;span class="o">=&lt;/span>on,vmx-hlt-exit&lt;span class="o">=&lt;/span>on,vmx-invlpg-exit&lt;span class="o">=&lt;/span>on,vmx-mwait-exit&lt;span class="o">=&lt;/span>on,vmx-rdpmc-exit&lt;span class="o">=&lt;/span>on,vmx-rdtsc-exit&lt;span class="o">=&lt;/span>on,vmx-cr3-load-noexit&lt;span class="o">=&lt;/span>on,vmx-cr3-store-noexit&lt;span class="o">=&lt;/span>on,vmx-cr8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-load-exit&lt;span class="o">=&lt;/span>on,vmx-cr8-store-exit&lt;span class="o">=&lt;/span>on,vmx-flexpriority&lt;span class="o">=&lt;/span>on,vmx-vnmi-pending&lt;span class="o">=&lt;/span>on,vmx-movdr-exit&lt;span class="o">=&lt;/span>on,vmx-io-exit&lt;span class="o">=&lt;/span>on,vmx-io-bitmap&lt;span class="o">=&lt;/span>on,vmx-mtf&lt;span class="o">=&lt;/span>on,vmx-msr-bitmap&lt;span class="o">=&lt;/span>on,vmx-monitor-exit&lt;span class="o">=&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">on,vmx-pause-exit&lt;span class="o">=&lt;/span>on,vmx-secondary-ctls&lt;span class="o">=&lt;/span>on,vmx-exit-nosave-debugctl&lt;span class="o">=&lt;/span>on,vmx-exit-load-perf-global-ctrl&lt;span class="o">=&lt;/span>on,vmx-exit-ack-intr&lt;span class="o">=&lt;/span>on,vmx-exit-save-pat&lt;span class="o">=&lt;/span>on,vmx-exit-load-pat&lt;span class="o">=&lt;/span>on,vmx-
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">exit-save-efer&lt;span class="o">=&lt;/span>on,vmx-exit-load-efer&lt;span class="o">=&lt;/span>on,vmx-exit-save-preemption-timer&lt;span class="o">=&lt;/span>on,vmx-entry-noload-debugctl&lt;span class="o">=&lt;/span>on,vmx-entry-ia32e-mode&lt;span class="o">=&lt;/span>on,vmx-entry-load-perf-global-ctrl&lt;span class="o">=&lt;/span>on,vmx-entry-
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">load-pat&lt;span class="o">=&lt;/span>on,vmx-entry-load-efer&lt;span class="o">=&lt;/span>on,vmx-eptp-switching&lt;span class="o">=&lt;/span>on -m &lt;span class="nv">size&lt;/span>&lt;span class="o">=&lt;/span>63488k -object &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;qom-type&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;memory-backend-ram&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;id&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;pc.ram&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;size&amp;#34;&lt;/span>:65011712&lt;span class="o">}&lt;/span> -overcommit mem-lock&lt;span class="o">=&lt;/span>off -sm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">p 1,sockets&lt;span class="o">=&lt;/span>1,dies&lt;span class="o">=&lt;/span>1,clusters&lt;span class="o">=&lt;/span>1,cores&lt;span class="o">=&lt;/span>1,threads&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span> -object &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;qom-type&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;iothread&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;id&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;iothread1&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> -uuid 5a9fc181-957e-5c32-9e5a-2de5e9673531 -smbios &lt;span class="nv">type&lt;/span>&lt;span class="o">=&lt;/span>1,manufacturer&lt;span class="o">=&lt;/span>Ku
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">beVirt,product&lt;span class="o">=&lt;/span>None,uuid&lt;span class="o">=&lt;/span>5a9fc181-957e-5c32-9e5a-2de5e9673531,family&lt;span class="o">=&lt;/span>KubeVirt -no-user-config -nodefaults -chardev socket,id&lt;span class="o">=&lt;/span>charmonitor,fd&lt;span class="o">=&lt;/span>20,server&lt;span class="o">=&lt;/span>on,wait&lt;span class="o">=&lt;/span>off -mon chard
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">ev&lt;/span>&lt;span class="o">=&lt;/span>charmonitor,id&lt;span class="o">=&lt;/span>monitor,mode&lt;span class="o">=&lt;/span>control -rtc &lt;span class="nv">base&lt;/span>&lt;span class="o">=&lt;/span>utc -no-shutdown -boot &lt;span class="nv">strict&lt;/span>&lt;span class="o">=&lt;/span>on -device &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;driver&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;pcie-root-port&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;port&amp;#34;&lt;/span>:16,&lt;span class="s2">&amp;#34;chassis&amp;#34;&lt;/span>:1,&lt;span class="s2">&amp;#34;id&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;pci.1&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;bus&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;pcie.0&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;mult
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">ifunction&amp;#34;&lt;/span>:true,&lt;span class="s2">&amp;#34;addr&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;0x2&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> -device &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;driver&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;pcie-root-port&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;port&amp;#34;&lt;/span>:17,&lt;span class="s2">&amp;#34;chassis&amp;#34;&lt;/span>:2,&lt;span class="s2">&amp;#34;id&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;pci.2&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;bus&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;pcie.0&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;addr&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;0x2.0x1&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> -device &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;driver&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;pcie-root-port&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;por
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">t&amp;#34;&lt;/span>:18,&lt;span class="s2">&amp;#34;chassis&amp;#34;&lt;/span>:3,&lt;span class="s2">&amp;#34;id&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;pci.3&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;bus&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;pcie.0&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;addr&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;0x2.0x2&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> -device &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;driver&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;pcie-root-port&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;port&amp;#34;&lt;/span>:19,&lt;span class="s2">&amp;#34;chassis&amp;#34;&lt;/span>:4,&lt;span class="s2">&amp;#34;id&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;pci.4&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;bus&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;pcie.0&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;addr&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;0x2.0x3&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> -devi
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ce &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;driver&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;pcie-root-port&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;port&amp;#34;&lt;/span>:20,&lt;span class="s2">&amp;#34;chassis&amp;#34;&lt;/span>:5,&lt;span class="s2">&amp;#34;id&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;pci.5&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;bus&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;pcie.0&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;addr&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;0x2.0x4&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> -device &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;driver&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;pcie-root-port&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;port&amp;#34;&lt;/span>:21,&lt;span class="s2">&amp;#34;chassis&amp;#34;&lt;/span>:6,&lt;span class="s2">&amp;#34;id&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;pci.6&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;bus
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;pcie.0&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;addr&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;0x2.0x5&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> -device &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;driver&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;pcie-root-port&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;port&amp;#34;&lt;/span>:22,&lt;span class="s2">&amp;#34;chassis&amp;#34;&lt;/span>:7,&lt;span class="s2">&amp;#34;id&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;pci.7&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;bus&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;pcie.0&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;addr&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;0x2.0x6&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> -device &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;driver&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;pcie-root-port&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;port
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">&amp;#34;&lt;/span>:23,&lt;span class="s2">&amp;#34;chassis&amp;#34;&lt;/span>:8,&lt;span class="s2">&amp;#34;id&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;pci.8&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;bus&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;pcie.0&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;addr&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;0x2.0x7&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> -device &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;driver&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;pcie-root-port&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;port&amp;#34;&lt;/span>:24,&lt;span class="s2">&amp;#34;chassis&amp;#34;&lt;/span>:9,&lt;span class="s2">&amp;#34;id&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;pci.9&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;bus&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;pcie.0&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;multifunction&amp;#34;&lt;/span>:true,&lt;span class="s2">&amp;#34;ad
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">dr&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;0x3&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> -device &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;driver&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;pcie-root-port&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;port&amp;#34;&lt;/span>:25,&lt;span class="s2">&amp;#34;chassis&amp;#34;&lt;/span>:10,&lt;span class="s2">&amp;#34;id&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;pci.10&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;bus&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;pcie.0&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;addr&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;0x3.0x1&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> -device &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;driver&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;virtio-scsi-pci-non-transitional&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;id
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;scsi0&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;bus&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;pci.5&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;addr&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;0x0&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> -device &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;driver&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;virtio-serial-pci-non-transitional&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;id&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;virtio-serial0&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;bus&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;pci.6&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;addr&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;0x0&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> -blockdev &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;driver&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;file&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;f
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">ilename&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;/var/run/kubevirt/container-disks/disk_0.img&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;node-name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;libvirt-3-storage&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;auto-read-only&amp;#34;&lt;/span>:true,&lt;span class="s2">&amp;#34;discard&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;unmap&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;cache&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;direct&amp;#34;&lt;/span>:true,&lt;span class="s2">&amp;#34;no-flush&amp;#34;&lt;/span>:false&lt;span class="o">}}&lt;/span> -b
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lockdev &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;node-name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;libvirt-3-format&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;read-only&amp;#34;&lt;/span>:true,&lt;span class="s2">&amp;#34;discard&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;unmap&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;cache&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;direct&amp;#34;&lt;/span>:true,&lt;span class="s2">&amp;#34;no-flush&amp;#34;&lt;/span>:false&lt;span class="o">}&lt;/span>,&lt;span class="s2">&amp;#34;driver&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;qcow2&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;file&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;libvirt-3-storage&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> -blockdev &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">&amp;#34;driver&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;file&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;filename&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;/var/run/kubevirt-ephemeral-disks/disk-data/containerdisk/disk.qcow2&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;node-name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;libvirt-2-storage&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;auto-read-only&amp;#34;&lt;/span>:true,&lt;span class="s2">&amp;#34;discard&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;unmap&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;c
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">ache&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;direct&amp;#34;&lt;/span>:true,&lt;span class="s2">&amp;#34;no-flush&amp;#34;&lt;/span>:false&lt;span class="o">}}&lt;/span> -blockdev &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;node-name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;libvirt-2-format&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;read-only&amp;#34;&lt;/span>:false,&lt;span class="s2">&amp;#34;discard&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;unmap&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;cache&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;direct&amp;#34;&lt;/span>:true,&lt;span class="s2">&amp;#34;no-flush&amp;#34;&lt;/span>:false&lt;span class="o">}&lt;/span>,&lt;span class="s2">&amp;#34;driver&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;qco
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">w2&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;file&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;libvirt-2-storage&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;backing&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;libvirt-3-format&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> -device &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;driver&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;virtio-blk-pci-non-transitional&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;bus&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;pci.7&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;addr&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;0x0&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;drive&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;libvirt-2-format&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;id&amp;#34;&lt;/span>:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">&amp;#34;ua-containerdisk&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;bootindex&amp;#34;&lt;/span>:1,&lt;span class="s2">&amp;#34;write-cache&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;on&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;werror&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;stop&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;rerror&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;stop&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> -blockdev &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;driver&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;file&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;filename&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;/var/run/kubevirt-ephemeral-disks/cloud-init-dat
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">a/default/testvm/noCloud.iso&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;node-name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;libvirt-1-storage&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;read-only&amp;#34;&lt;/span>:false,&lt;span class="s2">&amp;#34;discard&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;unmap&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;cache&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;direct&amp;#34;&lt;/span>:true,&lt;span class="s2">&amp;#34;no-flush&amp;#34;&lt;/span>:false&lt;span class="o">}}&lt;/span> -device &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;driver&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;virtio-blk-pc
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">i-non-transitional&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;bus&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;pci.8&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;addr&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;0x0&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;drive&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;libvirt-1-storage&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;id&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;ua-cloudinitdisk&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;write-cache&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;on&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;werror&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;stop&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;rerror&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;stop&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> -netdev &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;type&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;tap&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">,&lt;span class="s2">&amp;#34;fd&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;21&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;vhost&amp;#34;&lt;/span>:true,&lt;span class="s2">&amp;#34;vhostfd&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;23&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;id&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;hostua-default&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> -device &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;driver&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;virtio-net-pci-non-transitional&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;host_mtu&amp;#34;&lt;/span>:1500,&lt;span class="s2">&amp;#34;netdev&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;hostua-default&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;id&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;ua-default
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;mac&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;f6:45:e5:7e:ae:be&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;bus&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;pci.1&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;addr&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;0x0&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;romfile&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> -add-fd &lt;span class="nv">set&lt;/span>&lt;span class="o">=&lt;/span>0,fd&lt;span class="o">=&lt;/span>19,opaque&lt;span class="o">=&lt;/span>serial0-log -chardev socket,id&lt;span class="o">=&lt;/span>charserial0,fd&lt;span class="o">=&lt;/span>17,server&lt;span class="o">=&lt;/span>on,wait&lt;span class="o">=&lt;/span>off,logfile&lt;span class="o">=&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/dev/fdset/0,logappend&lt;span class="o">=&lt;/span>on -device &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;driver&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;isa-serial&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;chardev&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;charserial0&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;id&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;serial0&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;index&amp;#34;&lt;/span>:0&lt;span class="o">}&lt;/span> -chardev socket,id&lt;span class="o">=&lt;/span>charchannel0,fd&lt;span class="o">=&lt;/span>18,server&lt;span class="o">=&lt;/span>on,wait&lt;span class="o">=&lt;/span>off -device
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;driver&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;virtserialport&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;bus&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;virtio-serial0.0&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;nr&amp;#34;&lt;/span>:1,&lt;span class="s2">&amp;#34;chardev&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;charchannel0&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;id&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;channel0&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;org.qemu.guest_agent.0&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> -audiodev &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;id&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;audio1&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;driver&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;none
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> -vnc &lt;span class="nv">vnc&lt;/span>&lt;span class="o">=&lt;/span>unix:/var/run/kubevirt-private/a726afe8-d14f-4930-8240-86b47a25b547/virt-vnc,audiodev&lt;span class="o">=&lt;/span>audio1 -device &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;driver&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;VGA&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;id&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;video0&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;vgamem_mb&amp;#34;&lt;/span>:16,&lt;span class="s2">&amp;#34;bus&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;pcie.0&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">,&lt;span class="s2">&amp;#34;addr&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;0x1&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> -global ICH9-LPC.noreboot&lt;span class="o">=&lt;/span>off -watchdog-action reset -device &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;driver&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;virtio-balloon-pci-non-transitional&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;id&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;balloon0&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;free-page-reporting&amp;#34;&lt;/span>:true,&lt;span class="s2">&amp;#34;bus&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">:&lt;span class="s2">&amp;#34;pci.9&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;addr&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;0x0&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> -sandbox on,obsolete&lt;span class="o">=&lt;/span>deny,elevateprivileges&lt;span class="o">=&lt;/span>deny,spawn&lt;span class="o">=&lt;/span>deny,resourcecontrol&lt;span class="o">=&lt;/span>deny -msg &lt;span class="nv">timestamp&lt;/span>&lt;span class="o">=&lt;/span>on
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">qemu &lt;span class="m">156&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="m">0&lt;/span> 14:06 pts/0 00:00:00 ps -ef
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Note: To get the full output of &lt;code>ps -ef&lt;/code> it is easier to &lt;code>kubectl exec -it ... -- /bin/bash&lt;/code> and then obtain the output with &lt;code>ps -ef | more&lt;/code>.&lt;/p>
&lt;p>Let us elaborate on the above ouput in more detail.&lt;/p>
&lt;p>We can see that the container is started with &lt;code>PID 1&lt;/code> from &lt;code>/usr/bin/virt-launcher-monitor&lt;/code> which creates another process via &lt;code>/usr/bin/virt-launcher&lt;/code>. The &lt;code>virt-launcher&lt;/code> created another process via the &lt;a class="link" href="https://libvirt.org/manpages/virtqemud.html" target="_blank" rel="noopener"
>libvirt QEMU management daemon&lt;/a> &lt;code>/usr/sbin/virtqemud&lt;/code>.
What we can also clearly see is why the &lt;code>libvirt&lt;/code> project exists as an abstraction layer. Starting the &lt;code>qemu-kvm&lt;/code> with &lt;code>PID 89&lt;/code> with all of the parameters would be a very tough challenge without the &lt;code>libvirt&lt;/code> layer in between.&lt;/p>
&lt;p>If we want to look at the process tree more compactly, we can use &lt;code>pstree&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">kubectl &lt;span class="nb">exec&lt;/span> -it &lt;span class="k">$(&lt;/span>kubectl get po -l&lt;span class="o">=&lt;/span>vm.kubevirt.io/name&lt;span class="o">=&lt;/span>testvm -o custom-columns&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;:metadata.name&amp;#39;&lt;/span> --no-headers&lt;span class="k">)&lt;/span> -- pstree
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">virt-launcher-m-+-qemu-kvm---5*&lt;span class="o">[{&lt;/span>qemu-kvm&lt;span class="o">}]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">|&lt;/span>-virt-launcher-+-virtlogd---&lt;span class="o">{&lt;/span>virtlogd&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">|&lt;/span> &lt;span class="p">|&lt;/span>-virtqemud---18*&lt;span class="o">[{&lt;/span>virtqemud&lt;span class="o">}]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">|&lt;/span> &lt;span class="sb">`&lt;/span>-19*&lt;span class="o">[{&lt;/span>virt-launcher&lt;span class="o">}]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="sb">`&lt;/span>-7*&lt;span class="o">[{&lt;/span>virt-launcher-m&lt;span class="o">}]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>We can also leverage the &lt;code>libvirt&lt;/code> project so &lt;a class="link" href="https://kubevirt.io/user-guide/debug_virt_stack/virsh-commands/" target="_blank" rel="noopener"
>see and understand the running VM&lt;/a>.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ kubectl &lt;span class="nb">exec&lt;/span> -it &lt;span class="k">$(&lt;/span>kubectl get pod -l&lt;span class="o">=&lt;/span>vm.kubevirt.io/name&lt;span class="o">=&lt;/span>testvm -o custom-columns&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;:metadata.name&amp;#39;&lt;/span> --no-headers&lt;span class="k">)&lt;/span> -- virsh list
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Authorization not available. Check &lt;span class="k">if&lt;/span> polkit service is running or see debug message &lt;span class="k">for&lt;/span> more information.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Id Name State
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> default_testvm running
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ kubectl &lt;span class="nb">exec&lt;/span> -it &lt;span class="k">$(&lt;/span>kubectl get pod -l&lt;span class="o">=&lt;/span>vm.kubevirt.io/name&lt;span class="o">=&lt;/span>testvm -o custom-columns&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;:metadata.name&amp;#39;&lt;/span> --no-headers&lt;span class="k">)&lt;/span> -- virsh dominfo default_testvm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Authorization not available. Check &lt;span class="k">if&lt;/span> polkit service is running or see debug message &lt;span class="k">for&lt;/span> more information.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Id: &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Name: default_testvm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">UUID: 5a9fc181-957e-5c32-9e5a-2de5e9673531
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">OS Type: hvm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">State: running
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CPU&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>: &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CPU time: 23.1s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Max memory: &lt;span class="m">63488&lt;/span> KiB
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Used memory: &lt;span class="m">62500&lt;/span> KiB
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Persistent: yes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Autostart: disable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Managed save: no
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Security model: none
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Security DOI: &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>In theory you could also manipulate the VM state with the &lt;code>virsh&lt;/code> commands, but this is not the real intention of the KubeVirt project. Nevertheless, we will do that for the sake of our understanding. With &lt;code>virsh destroy &amp;lt;DOMAIN&amp;gt;&lt;/code> we can forcefully stop a VM:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ kubectl &lt;span class="nb">exec&lt;/span> -it &lt;span class="k">$(&lt;/span>kubectl get pod -l&lt;span class="o">=&lt;/span>vm.kubevirt.io/name&lt;span class="o">=&lt;/span>testvm -o custom-columns&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;:metadata.name&amp;#39;&lt;/span> --no-headers&lt;span class="k">)&lt;/span> -- virsh destroy default_testvm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Authorization not available. Check &lt;span class="k">if&lt;/span> polkit service is running or see debug message &lt;span class="k">for&lt;/span> more information.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Domain &lt;span class="s1">&amp;#39;default_testvm&amp;#39;&lt;/span> destroyed
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ kubectl get pods -w
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">virt-launcher-testvm-v5h4f 0/3 Init:0/2 &lt;span class="m">0&lt;/span> 0s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">virt-launcher-testvm-v5h4f 0/3 Init:0/2 &lt;span class="m">0&lt;/span> 1s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">virt-launcher-testvm-v5h4f 0/3 Init:1/2 &lt;span class="m">0&lt;/span> 2s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">virt-launcher-testvm-v5h4f 0/3 PodInitializing &lt;span class="m">0&lt;/span> 9s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">virt-launcher-testvm-v5h4f 3/3 Running &lt;span class="m">0&lt;/span> 20s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">virt-launcher-testvm-v5h4f 3/3 Running &lt;span class="m">0&lt;/span> 20s
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>The &lt;code>VirtualMachine&lt;/code> will automatically be restarted because we have set the &lt;code>spec.runStrategy: Always&lt;/code> with our startup script.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ kubectl get vm testvm -oyaml &lt;span class="p">|&lt;/span> yq -r &lt;span class="s1">&amp;#39;.spec.runStrategy&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Always
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>We can also access the &lt;code>VirtualMachine&lt;/code> with the &lt;code>virtctl console&lt;/code> command. Let&amp;rsquo;s create a file inside the VM:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ virtctl console testvm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Successfully connected to testvm console. The escape sequence is ^&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">login as &lt;span class="s1">&amp;#39;cirros&amp;#39;&lt;/span> user. default password: &lt;span class="s1">&amp;#39;gocubsgo&amp;#39;&lt;/span>. use &lt;span class="s1">&amp;#39;sudo&amp;#39;&lt;/span> &lt;span class="k">for&lt;/span> root.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">testvm login: cirros
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Password:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ touch test.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ uptime
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 15:46:49 up &lt;span class="m">28&lt;/span> min, &lt;span class="m">1&lt;/span> users, load average: 0.00, 0.00, 0.00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ ls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">test.txt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Now let us migrate the VM to another &lt;code>node&lt;/code> and observe the &lt;code>virtualmachineinstancemigrations&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ virtctl migrate testvm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">VM testvm was scheduled to migrate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ kubectl get virtualmachineinstancemigrations -w
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME PHASE VMI
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kubevirt-migrate-vm-kbtgn Scheduling testvm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kubevirt-migrate-vm-kbtgn Scheduled testvm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kubevirt-migrate-vm-kbtgn PreparingTarget testvm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kubevirt-migrate-vm-kbtgn TargetReady testvm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kubevirt-migrate-vm-kbtgn Running testvm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kubevirt-migrate-vm-kbtgn Succeeded testvm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kubevirt-migrate-vm-kbtgn Succeeded testvm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kubevirt-migrate-vm-kbtgn Succeeded testvm
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>The migration is completed, which we can also observe on the &lt;code>Pods&lt;/code>, as the &lt;code>virt-launcher-testvm-v5h4f&lt;/code> on node &lt;code>kind-worker&lt;/code> is gone and spawned another one on &lt;code>kind-worker2&lt;/code>. The &lt;code>VirtualMachine&lt;/code> is still running:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ kubectl get pods -owide
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">virt-launcher-testvm-9ggsf 3/3 Running &lt;span class="m">0&lt;/span> 41s 10.244.1.8 kind-worker2 &amp;lt;none&amp;gt; 1/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">virt-launcher-testvm-v5h4f 0/3 Completed &lt;span class="m">0&lt;/span> 29m 10.244.2.20 kind-worker &amp;lt;none&amp;gt; 1/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ virtctl console testvm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Successfully connected to testvm console. The escape sequence is ^&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ ls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">test.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ uptime
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 15:48:10 up &lt;span class="m">29&lt;/span> min, &lt;span class="m">1&lt;/span> users, load average: 0.00, 0.00, 0.00
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>As pointed out earlier, a &lt;code>restart&lt;/code> of the VM will result in a loss of all data due to the &lt;code>containerDisk&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ virtctl restart testvm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">VM testvm was scheduled to restart
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ kubectl get pods -w
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">virt-launcher-testvm-9ggsf 3/3 Terminating &lt;span class="m">0&lt;/span> 6m28s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">virt-launcher-testvm-9ggsf 0/3 Completed &lt;span class="m">0&lt;/span> 6m29s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">virt-launcher-testvm-4sn54 0/3 Pending &lt;span class="m">0&lt;/span> 0s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">virt-launcher-testvm-4sn54 0/3 Init:0/2 &lt;span class="m">0&lt;/span> 0s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">virt-launcher-testvm-4sn54 0/3 Init:1/2 &lt;span class="m">0&lt;/span> 2s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">virt-launcher-testvm-4sn54 0/3 PodInitializing &lt;span class="m">0&lt;/span> 8s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">virt-launcher-testvm-4sn54 3/3 Running &lt;span class="m">0&lt;/span> 21s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ virtctl console testvmvm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Successfully connected to testvm console. The escape sequence is ^&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">login as &lt;span class="s1">&amp;#39;cirros&amp;#39;&lt;/span> user. default password: &lt;span class="s1">&amp;#39;gocubsgo&amp;#39;&lt;/span>. use &lt;span class="s1">&amp;#39;sudo&amp;#39;&lt;/span> &lt;span class="k">for&lt;/span> root.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">testvm login: cirros
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Password:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ ls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ uptime
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 15:54:16 up &lt;span class="m">0&lt;/span> min, &lt;span class="m">1&lt;/span> users, load average: 0.00, 0.00, 0.00
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="experimenting-with-a-persistent-vm">Experimenting with a persistent VM
&lt;/h3>&lt;p>Now let us take a look at a &lt;code>VirtualMachine&lt;/code> which is using a Read Write Once (RWO) persistent storage and a &lt;a class="link" href="https://ftp.uni-stuttgart.de/fedora/releases/41/Cloud/x86_64/images/" target="_blank" rel="noopener"
>fedora 41 cloud image&lt;/a>. This &lt;code>VirtualMachine&lt;/code> is relying on the Containerized Data Importer (CDI) installed with &lt;a class="link" href="#provision-kind-cluster-with-kubevirt" >the previous bash script&lt;/a>. The CDI will import the cloud image into a &lt;code>DataVolume&lt;/code> which is an abstraction on top of a Persistent Volume Claim (PVC).&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">kubevirt.io/v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">VirtualMachine&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">kubevirt.io/vm&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">fedora-vm&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">fedora-vm&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">dataVolumeTemplates&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">creationTimestamp&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">src-dv&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">storage&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">accessModes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">ReadWriteOnce&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">volumeMode&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Filesystem&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">resources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">requests&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">storage&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">10Gi&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">storageClassName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">standard &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">source&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">http&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">url&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">https://download.fedoraproject.org/pub/fedora/linux/releases/41/Cloud/x86_64/images/Fedora-Cloud-Base-Generic-41-1.4.x86_64.qcow2 &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">runStrategy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Always&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">template&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">kubevirt.io/vm&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">fedora-vm&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">domain&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">cpu&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">sockets&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">cores&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">threads&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">devices&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">disks&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">disk&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">bus&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">virtio&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">datavolumedisk1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">interfaces&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">masquerade&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>{}&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">default&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">resources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">requests&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">memory&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">2Gi&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">terminationGracePeriodSeconds&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">0&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">volumes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">dataVolume&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">src-dv&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">datavolumedisk1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">cloudInitNoCloud&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">userData&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">|-&lt;/span>&lt;span class="sd">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> #cloud-config
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> user: fedora
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> password: fedora
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> chpasswd: { expire: False }
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> runcmd:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> - sudo dnf update
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> - sudo dnf install httpd -y
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> - sudo sed -iE &amp;#39;s/Listen 80/Listen 8080/&amp;#39; /etc/httpd/conf/httpd.conf
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> - sudo systemctl enable httpd.service
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> - sudo systemctl start httpd.service
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> - echo &amp;#39;This is demo VM 1 :)&amp;#39; &amp;gt; /var/www/html/index.html&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">cloudinitdisk&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">networks&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">default&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">pod&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>{}&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>This VM has dedicated cpu resources in &lt;code>.spec.template.spec.domain.cpu&lt;/code> which are actually the default values. Additionally we are installing &lt;code>httpd&lt;/code>, operate it on port &lt;code>8080&lt;/code> and write our custom &lt;code>index.html&lt;/code> file via the &lt;code>cloud-init&lt;/code>.&lt;/p>
&lt;p>Let&amp;rsquo;s create the VM and expose a &lt;code>NodePort&lt;/code> service:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ kubectl apply -f fedora-vm.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ virtctl expose vmi fedora-vm --name&lt;span class="o">=&lt;/span>fedora-http --port&lt;span class="o">=&lt;/span>&lt;span class="m">8080&lt;/span> --type&lt;span class="o">=&lt;/span>NodePort
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ kubectl get svc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME TYPE CLUSTER-IP EXTERNAL-IP PORT&lt;span class="o">(&lt;/span>S&lt;span class="o">)&lt;/span> AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">fedora-http NodePort 10.96.225.134 &amp;lt;none&amp;gt; 8080:31538/TCP 22h
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>We can also reach it with &lt;code>curl&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ curl &lt;span class="k">$(&lt;/span>kubectl get node kind-worker -ojson &lt;span class="p">|&lt;/span> jq -r &lt;span class="s1">&amp;#39;.status.addresses[0].address&amp;#39;&lt;/span>&lt;span class="k">)&lt;/span>:&lt;span class="k">$(&lt;/span>kubectl get svc fedora-http -ojson &lt;span class="p">|&lt;/span> jq -r &lt;span class="s1">&amp;#39;.spec.ports[0].nodePort&amp;#39;&lt;/span>&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">This is demo VM &lt;span class="m">1&lt;/span> :&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>This &lt;code>VirtualMachine&lt;/code> is now utilizing a persistent storage via &lt;code>DataVolume&lt;/code> and &lt;code>PVC&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ kubectl get pvc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS VOLUME CAPACITY ACCESS MODES STORAGECLASS VOLUMEATTRIBUTESCLASS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">src-dv Bound pvc-66eec301-9ec0-48c9-988f-f3383dbdf2ec &lt;span class="m">11362347344&lt;/span> RWO standard &amp;lt;unset&amp;gt; 2m37s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ kubectl get dv
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME PHASE PROGRESS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">src-dv Succeeded 100.0% 2m41s
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Note: The &lt;code>PVC&lt;/code> is &lt;code>RWO&lt;/code>, which does not allow us to live migrate the VM between hosts. Thus we had explored the live migration with the &lt;a class="link" href="#experimenting-with-the-containerdisk-vm" >containerDisk VM in the previous section&lt;/a>.&lt;/p>
&lt;p>We will test the persistency of the storage:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ virtctl console fedora-vm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Successfully connected to fedora-vm console. The escape sequence is ^&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">fedora-vm login: fedora
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Password:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>fedora@fedora-vm ~&lt;span class="o">]&lt;/span>$ ls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>fedora@fedora-vm ~&lt;span class="o">]&lt;/span>$ touch test.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>fedora@fedora-vm ~&lt;span class="o">]&lt;/span>$ &lt;span class="nb">exit&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ virtctl restart fedora-vm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">VM fedora-vm was scheduled to restart
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ kubectl get pods -w
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">virt-launcher-fedora-vm-4gtvx 0/2 ContainerCreating &lt;span class="m">0&lt;/span> 2s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">virt-launcher-testvm-4sn54 3/3 Running &lt;span class="m">0&lt;/span> 27m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">virt-launcher-fedora-vm-4gtvx 2/2 Running &lt;span class="m">0&lt;/span> 4s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ virtctl console fedora-vm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Successfully connected to fedora-vm console. The escape sequence is ^&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">fedora-vm login: fedora
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Password:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Last login: Mon Feb &lt;span class="m">17&lt;/span> 16:22:18 on ttyS0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>fedora@fedora-vm ~&lt;span class="o">]&lt;/span>$ ls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">test.txt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Gaming on Linux with a decade old hardware</title><link>https://www.niederwanger.dev/p/gaming-on-linux-with-a-decade-old-hardware/</link><pubDate>Fri, 31 Jan 2025 00:00:00 +0000</pubDate><guid>https://www.niederwanger.dev/p/gaming-on-linux-with-a-decade-old-hardware/</guid><description>&lt;img src="https://www.niederwanger.dev/p/gaming-on-linux-with-a-decade-old-hardware/gaming.jpg" alt="Featured image of post Gaming on Linux with a decade old hardware" />&lt;h2 id="a-retrospective">A retrospective
&lt;/h2>&lt;p>Ten years ago I have used my exact same workstation hardware to try my first linux desktop experience.
My hardware is:&lt;/p>
&lt;ul>
&lt;li>Intel Xeon CPU E3-1231 v3&lt;/li>
&lt;li>Nvidia GTX 970
&lt;ul>
&lt;li>broke twice, but one time within warranty&lt;/li>
&lt;li>replaced it with a GTX 1050Ti&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>16 GB DDR3 RAM&lt;/li>
&lt;/ul>
&lt;p>As you can tell, that is not really a powerful hardware nowadays anymore.&lt;/p>
&lt;p>Back then I was using Ubuntu in dual boot with Windows 7. As I was not sure, if Linux would actually work as I hoped it to work, I didn&amp;rsquo;t dare to completely wipe my Windows. Fortunately, I haven&amp;rsquo;t done it as my Linux desktop experience was quite tedious. The biggest pain points I was facing were:&lt;/p>
&lt;ul>
&lt;li>I was not that familiar with Linux itself (at least compared to now)&lt;/li>
&lt;li>Installing the correct hardware drivers was a nightmare&lt;/li>
&lt;li>Most games didn&amp;rsquo;t offer native Linux support thus you had to rely heavily on &lt;a class="link" href="https://www.winehq.org/" target="_blank" rel="noopener"
>wine&lt;/a>&lt;/li>
&lt;li>Almost no native gaming clients&lt;/li>
&lt;li>I could not get some games working on linux&lt;/li>
&lt;li>Looking at forums you occasionally found threads about people complaining to be banned, because they were playing on a non supported operating system&lt;/li>
&lt;/ul>
&lt;h2 id="why-now">Why now?
&lt;/h2>&lt;p>As time has passed, I was evaluating if I want to migrate my Windows 10 to Windows 11. After checking the &lt;a class="link" href="https://www.microsoft.com/en-us/windows/windows-11-specifications" target="_blank" rel="noopener"
>system requirements for Windows 11&lt;/a>, I found out that my PC was lacking on the following parts:&lt;/p>
&lt;ul>
&lt;li>Convert Master Boot Record (MBR) to GUID Partition Table (GPT) to enable UEFI boot&lt;/li>
&lt;li>No Trusted Platform Module (TPM)&lt;/li>
&lt;li>Unsupported processor&lt;/li>
&lt;/ul>
&lt;p>While converting the MBR to GPT was a software issue and can be &lt;a class="link" href="https://www.windowscentral.com/how-convert-mbr-disk-gpt-move-bios-uefi-windows-10" target="_blank" rel="noopener"
>solved with this guide&lt;/a>, the remaining items are hardware issues. There might be the possibility to work around this, but I didn&amp;rsquo;t like the direction Windows was aiming for anyway. Consequently, I have decided to give Linux another chance.&lt;/p>
&lt;h2 id="the-linux-experience">The Linux Experience
&lt;/h2>&lt;h3 id="which-distro">Which Distro?
&lt;/h3>&lt;p>One of the first questions which come up, when you think about Linux is, which distribution to use? Given that I work for &lt;a class="link" href="https://www.redhat.com/en" target="_blank" rel="noopener"
>Red Hat&lt;/a>, I have decided to use &lt;a class="link" href="https://fedoraproject.org/" target="_blank" rel="noopener"
>Fedora Workstation&lt;/a>. This is mostly due to the &lt;a class="link" href="https://www.redhat.com/en/technologies/linux-platforms/enterprise-linux" target="_blank" rel="noopener"
>Red Hat Enterprise Linux&lt;/a> like behavior.&lt;/p>
&lt;h3 id="usability">Usability
&lt;/h3>&lt;p>My impression is, that the usability has largely improved in the desktop space. The graphical user interface (GUI) looks very modern. You have the possibility to use multiple screens (as with MacOS). You can use the Software Center to obtain a ton of software including third parties, like &lt;code>rpmfusion&lt;/code> and &lt;code>flatpaks&lt;/code>. Most of the things can be configured via GUI, if you desire to do so.&lt;/p>
&lt;h3 id="are-all-problems-solved-now">Are all problems solved now?
&lt;/h3>&lt;p>Let me elaborate on the problems mentioned earlier.&lt;/p>
&lt;h4 id="drivers">Drivers
&lt;/h4>&lt;p>Per default Fedora was shipped with the &lt;a class="link" href="https://nouveau.freedesktop.org/" target="_blank" rel="noopener"
>NVIDIA nouveau&lt;/a> drivers. Those drivers worked well for me on native Linux games. However, they performed very poorly on games which were relying on Wine. Yet again I had to install the GPU drivers from NVIDIA. To my surprise this was a very easy task. The software center had automatically detected which third party driver my system would need and I could install them very comfortably via the GUI.
&lt;img src="https://www.niederwanger.dev/p/gaming-on-linux-with-a-decade-old-hardware/hardware_drivers.png"
width="1322"
height="922"
srcset="https://www.niederwanger.dev/p/gaming-on-linux-with-a-decade-old-hardware/hardware_drivers_hu_804455fa77f9e44.png 480w, https://www.niederwanger.dev/p/gaming-on-linux-with-a-decade-old-hardware/hardware_drivers_hu_9f5811a5ad0f27b9.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="143"
data-flex-basis="344px"
>&lt;/p>
&lt;h4 id="gaming-clients">Gaming clients
&lt;/h4>&lt;p>Unfortunately some gaming clients like the &lt;a class="link" href="https://www.blizzard.com/en-us/" target="_blank" rel="noopener"
>Blizzard Battle.net&lt;/a> or &lt;a class="link" href="https://www.gog.com/wishlist/galaxy/release_the_gog_galaxy_client_for_linux" target="_blank" rel="noopener"
>GOG Galaxy&lt;/a> do not offer native Linux support. Consequently you will need to take a look at other solutions.
Currently there are differnet gaming clients available. The most common ones, besides &lt;a class="link" href="https://steamcommunity.com/" target="_blank" rel="noopener"
>Steam&lt;/a>, are &lt;a class="link" href="https://heroicgameslauncher.com/" target="_blank" rel="noopener"
>Heroic Games Launcher&lt;/a> and &lt;a class="link" href="https://lutris.net/" target="_blank" rel="noopener"
>Lutris&lt;/a>. Both of those clients have their pros and cons. Lutris allows you to connect to the Battle.net
&lt;img src="https://www.niederwanger.dev/p/gaming-on-linux-with-a-decade-old-hardware/lutris_battle_net.png"
width="1920"
height="1048"
srcset="https://www.niederwanger.dev/p/gaming-on-linux-with-a-decade-old-hardware/lutris_battle_net_hu_dced39dcc6f99297.png 480w, https://www.niederwanger.dev/p/gaming-on-linux-with-a-decade-old-hardware/lutris_battle_net_hu_e7486340295161df.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="183"
data-flex-basis="439px"
> but does not offer cloud save files for the GOG Galaxy. While the Heroic Games Launcher does support the cloud saves, you cannot use it for the Blizzard games. Consequently, there is no one size fits all solution.&lt;/p>
&lt;h4 id="cloud-saves">Cloud saves
&lt;/h4>&lt;p>An additional problem arises, when we talk about cloud saves. While, I cannot tell if this issue is persisnt across all gaming clients, but I can provide the following example: &lt;a class="link" href="https://www.gog.com/en/game/faster_than_light" target="_blank" rel="noopener"
>FTL: Advanced Edition&lt;/a> is a strategy game which I had bought via GOG Galaxy (Note: I could have also bought it via Steam). To have my cloud save files, I would be required to use Heroic Games Launcher instead of Lutris. On the Heroic Games Launcher I have two options:&lt;/p>
&lt;ol>
&lt;li>Install the Linux native version of the game (preferred)&lt;/li>
&lt;li>Install the Windows version of the game and use Wine.&lt;/li>
&lt;/ol>
&lt;p>After trying option 1, I rather quickly found out that I do not have access to my cloud save files as they are tied to my previous operating system installation. After wiping the linux native installation, I had installed the Windows version. Then I had access to my save files. Funnily enough, the save files are just text files which you can copy around and thus use them even with the Linux version. Nevertheless, to get the access to the cloud save from the previous Windows installation, you will have to download the Windows version. Especially as the GOG Galaxy does not offer a download of the cloud saves &lt;a class="link" href="https://www.gog.com/account/cloud-saves" target="_blank" rel="noopener"
>neither via the website&lt;/a> nor &lt;a class="link" href="https://docs.gog.com/gc-cloud-saves/" target="_blank" rel="noopener"
>via an API&lt;/a>.&lt;/p>
&lt;h2 id="performance">Performance
&lt;/h2>&lt;p>Before I can elaborate on the performance, I need to clarify, that there are no metrics being compared between the operating systems. I will just refer to the same games on equal graphic settings and see if those feel fluid (like before). The games I will be referring to are:&lt;/p>
&lt;ul>
&lt;li>Heroes of the Storm&lt;/li>
&lt;li>Frostpunk&lt;/li>
&lt;li>Elden Ring&lt;/li>
&lt;/ul>
&lt;h3 id="heroes-of-the-storm">Heroes of the Storm
&lt;/h3>&lt;ul>
&lt;li>Client: Lutris&lt;/li>
&lt;li>Game acquired via: GOG Galaxy&lt;/li>
&lt;li>Native platform(s): Windows&lt;/li>
&lt;/ul>
&lt;p>Lutris allows you to install the &lt;a class="link" href="https://download.battle.net/de-de/desktop" target="_blank" rel="noopener"
>Battle.net Desktop Client&lt;/a> and then the game via the client as usual. This game works very well on Linux with equal graphic settings, i.e. &lt;code>High&lt;/code>. When playing around with ALT+TAB and the Super/Windows key I found out that it is better to run this game with the &lt;code>Display Mode: Windowed Fullscreen&lt;/code>. One thing which worked even better on Linux than Windows is, that I did not run into the &lt;a class="link" href="https://us.forums.blizzard.com/en/heroes/t/infinite-reconnecting-screen/26423" target="_blank" rel="noopener"
>Infinite Reconnecting screen&lt;/a> which is some odd bug in the game which was never fixed.&lt;/p>
&lt;h3 id="frostpunk">Frostpunk
&lt;/h3>&lt;ul>
&lt;li>Client: Heroic Games Launcher&lt;/li>
&lt;li>Game acquired via: GOG Galaxy&lt;/li>
&lt;li>Native platform(s): Windows&lt;/li>
&lt;/ul>
&lt;p>There was no issue with playing the game. It runs fluent and had no issues when tabbing in and out. The cloud saves caused some difficulties, but this seems to be game rather than platform specific.&lt;/p>
&lt;h3 id="elden-ring">Elden Ring
&lt;/h3>&lt;ul>
&lt;li>Client: Steam&lt;/li>
&lt;li>Game acquired via: Steam&lt;/li>
&lt;li>Native platform(s): Windows&lt;/li>
&lt;/ul>
&lt;p>This masterpiece is surely the most resource intense game on the list. Nevertheless, Linux was still able to run it without any issue on &lt;code>High&lt;/code> graphic settings. Via Steam I could also easily connect my PS3 controller without any additional software and had access to all cloud saves.&lt;/p>
&lt;h2 id="which-games-are-problematic">Which games are problematic?
&lt;/h2>&lt;p>Generally speaking games which use kernel-level anti-cheat technology might not run on linux due to the use of Wine or Proton. A list of games relying on kernel-level anti-cheat can be found &lt;a class="link" href="https://www.pcgamingwiki.com/wiki/List_of_games_with_anti-cheat_technology" target="_blank" rel="noopener"
>here&lt;/a>. If you look at the list very carefully, you will see that Elden Ring also uses kernel-level anti-cheat. This was no issue for me, as I was not playing online.&lt;/p>
&lt;p>I have a strong opinion that kernel-level anti-cheat gaming software should not be used, because the kernel is not a place for user software. Especially not gaming software. A human friendly one minute explanation can be found on &lt;a class="link" href="https://www.youtube.com/watch?v=V1HwhwXelZo" target="_blank" rel="noopener"
>Youtube from Pirate Software below&lt;/a>:
&lt;div class="video-wrapper">
&lt;iframe loading="lazy"
src="https://www.youtube.com/embed/V1HwhwXelZo"
allowfullscreen
title="YouTube Video"
>
&lt;/iframe>
&lt;/div>
&lt;/p>
&lt;h2 id="conclusion">Conclusion
&lt;/h2>&lt;p>The linux desktop has become way more user friendly than it was before. As you have seen, there might still be some minor issues, but it is not really blocking you from using it as a main operating system. My experience is very positive and I am more than happy that I had spent time on it.&lt;/p></description></item><item><title>Building a blog with Hugo</title><link>https://www.niederwanger.dev/p/building-a-blog/</link><pubDate>Wed, 15 Jan 2025 00:00:00 +0000</pubDate><guid>https://www.niederwanger.dev/p/building-a-blog/</guid><description>&lt;img src="https://www.niederwanger.dev/p/building-a-blog/cover.jpg" alt="Featured image of post Building a blog with Hugo" />&lt;h1 id="building-a-blog-is-easy-with-the-right-tools">Building a blog is easy with the right tools
&lt;/h1>&lt;p>As I was looking for a static site generator which supports &lt;code>Markdown&lt;/code> as an input, I came across &lt;a class="link" href="https://gohugo.io/" target="_blank" rel="noopener"
>Hugo&lt;/a>. Hugo is an open source static site generator written in &lt;code>Go&lt;/code>. Hugo supports a lot of built in &lt;a class="link" href="https://themes.gohugo.io/" target="_blank" rel="noopener"
>Themes&lt;/a>. One easy Theme to get started is the &lt;a class="link" href="https://github.com/CaiJimmy/hugo-theme-stack-starter" target="_blank" rel="noopener"
>Hugo Theme Stack&lt;/a> from &lt;a class="link" href="https://github.com/CaiJimmy" target="_blank" rel="noopener"
>CaiJimmy&lt;/a>.&lt;/p></description></item><item><title>Archives</title><link>https://www.niederwanger.dev/archives/</link><pubDate>Sun, 06 Mar 2022 00:00:00 +0000</pubDate><guid>https://www.niederwanger.dev/archives/</guid><description/></item><item><title>Cookie Policy</title><link>https://www.niederwanger.dev/cookie-policy/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://www.niederwanger.dev/cookie-policy/</guid><description>&lt;p>We collect usage data using google analytics for the purposes of visualizing the traffic on this website. All data is anonymized and we do not sell or share any data with third parties. If you choose to deny, no info will be collected whatsoever.&lt;/p></description></item><item><title>Search</title><link>https://www.niederwanger.dev/search/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://www.niederwanger.dev/search/</guid><description/></item></channel></rss>